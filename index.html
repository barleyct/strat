<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- fonts -->
    <script defer src="fonts/js/all.min.js"></script>

    <title>Strategy& - Aperture - Dashboard</title>
  </head>
  <body>

    <header>

      <!-- Logo -->
      <nav class="site-nav-logo navbar navbar-light bg-light">
        <div class="container">

          <a class="navbar-brand" href="index.html">
            <img src="images/co-brand-logo@1X.png" width="145" height="45" class="d-inline-block align-top" alt="">
            Aperture
          </a>

          <!-- client logo -->
          <a class="float-right" href="#">
            <img class="rounded-circle border" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2275%22%20height%3D%2275%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2075%2075%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_1675f575c26%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.1)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A10pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_1675f575c26%22%3E%3Crect%20width%3D%2275%22%20height%3D%2275%22%20fill%3D%22white%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%2218.5546875%22%20y%3D%2242%22%3E75x75%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" width="145" height="45" class="d-inline-block align-top" alt="">
          </a>

        </div>
      </nav>

      <!-- Navigation -->
      <nav class="site-nav navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link active" href="index.html">Overview</a>
              <a class="nav-item nav-link" href="details.html">Details</a>
              <a class="nav-item nav-link" href="archetypes.html">Archetypes</a>
              <a class="nav-item nav-link" href="consistency.html">Consistency</a>
              <a class="nav-item nav-link" href="demographics.html">Demographics</a>
              <a class="nav-item nav-link" href="#">Pulse Check</a>
            </div>
          </div>
        </div>
      </nav>

      <!-- Navigation: Sub Header -->
      <nav class="site-sub-nav">
        <div class="container">

          <div class="gutter"></div>
          <div class="nav nav--sub" role="tablist">
            <a class="nav-item nav-link active" id="nav-dashb-tab" data-toggle="tab" href="#nav-dashb" role="tab" aria-controls="nav-dashb" aria-selected="true">Dashboard</a>
            <span class="sep border-right"></span>
            <a class="nav-item nav-link" id="nav-insights-tab" data-toggle="tab" href="#nav-insights" role="tab" aria-controls="nav-insights" aria-selected="false">Insights</a>
          </div>

        </div>
      </nav>

    </header>


    <main class="mt-2">
      
      <!-- Tabbed Content -->
      <div class="tab-content tb-dashboard" id="nav-tabContent">

        <!-- Dashboard -->
        <div class="tab-pane fade show active tb--dashb" id="nav-dashb" role="tabpanel" aria-labelledby="nav-dashb-tab">

          <div class="container">

            <!-- Graphs -->
            <div class="row">

              <div class="col-5 col-md-12 col-lg-5">

                <h5>Performance by Category</h5>

                <div class="graph-container perf-cat-graph" id="perf_cat_graph_full">

                  <div class="graph-info js-perf-cat-graph-info row justify-content-center align-items-end">
                    <!-- Filled using template -->
                  </div>

                  <div class="graph cursor-p" id="perf_cat_graph">

                    <svg class="w-100 h-100"></svg>
                    
                  </div>

                  <div class="md-cb btn btn-transparent pl-0 js-show-details" data-html2canvas-ignore>
                    <input type="checkbox" /> <label>See details</label>
                  </div>
                  
                </div>

                <button class="btn btn-download" data-target="#perf_cat_graph_full" data-html2canvas-ignore>
                  <i class="icon icon--download"></i>
                </button>
                
              </div>

              <div class="col-7 col-md-12 col-lg-7 pr-5-ipad-l">

                <div>
                  <h5 class="inline">Performance by</h5>
                  <div class="dropdown inline dashboard-select js-dropdown-category">
                    <!--btn-secondary removed to prevent click color change-->
                    <button class="btn dropdown-toggle dashboard-select__category" type="button" id="dropdownCategory" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Org. Unit
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownCategory">
                      <a class="dropdown-item" href="#" data-value="Management Level">Management Level</a>
                      <a class="dropdown-item" href="#" data-value="Tenure">Tenure</a>
                      <a class="dropdown-item" href="#" data-value="Org. Unit">Org. Unit</a>
                    </div>
                  </div>
                </div>

                <div class="graph-container graph-container--table mt-4">

                  <div class="graph h-100" id="perf_cat_table">
                    
                  </div>
                  
                </div>

                <button class="btn btn-download mr-5-ipad-l" data-target="#perf_cat_table" data-html2canvas-ignore>
                  <i class="icon icon--download"></i>
                </button>
                
              </div>
              
            </div>

          </div>

          <!-- Highlights -->
          <div class="tb--dashb__highlights">

            <div class="container">

              <h5 class="mb-4">Highlights</h5>

              <div class="row">

                <div class="col highlights-content" id="highlights_section">
                  <!-- Rendered with Template -->
                </div>
                
              </div>


            </div>
            
          </div>

          <!-- Participation -->
          <div class="tb--dashb__participation">

            <div class="container">

              <h5 class="mb-4">Participation</h5>

              <div id="participants_section" class="row pc-indicator align-items-center cursor-p js-hook" data-url="demographics.html">
                <!-- Rendered using template -->
              </div>

            </div>
            
          </div>

          <!-- PDF Button -->
          <button class="btn btn-pdf js-btn-pdf" data-singlepage data-target="#nav-dashb" data-html2canvas-ignore>
            <i class="icon icon--pdf"></i>
          </button>

          <!-- Camera Button -->
          <button class="btn btn-camera mt-5 js-btn-download" data-target="#nav-dashb" data-html2canvas-ignore>
            <i class="icon icon--camera"></i>
          </button>
          
          
        </div>

        <!-- Insights -->
        <div class="tab-pane fade" id="nav-insights" role="tabpanel" aria-labelledby="nav-insights-tab">

          <div class="container">

            <div class="row">

              <!-- Side Panel -->
              <div class="col-3">

                <!-- Filters -->
                <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
                  <div class="dropdown-menu show">
                    <h6 class="dropdown-header">Filter for:</h6>
                    <div class="dropright">
                      <div class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <input type="checkbox" value="year" checked /> <label>Year</label>
                        <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="dropdown-menu dropdown-menu--submenu">
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="2018" checked /> <label>2018</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="2017" /> <label>2017</label>
                        </div>
                      </div>
                      <div class="dropdown-item-selection active">
                        <span class="dropdown-item-text">2018</span>
                      </div>
                    </div>
                    <div class="dropright">
                      <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <input type="checkbox" value="org_unit" /> <label>Org. Unit</label>
                        <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="dropdown-menu dropdown-menu--submenu">
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Org. Unit 1" /> <label>Org. Unit 1</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Org. Unit 2" /> <label>Org. Unit 2</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Org. Unit 3" /> <label>Org. Unit 3</label>
                        </div>
                      </div>
                      <div class="dropdown-item-selection active"></div>
                    </div>
                    <div class="dropright">
                      <div class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <input type="checkbox" value="management"/> <label>Management Level</label>
                        <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="dropdown-menu dropdown-menu--submenu">
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="C-Level"/> <label>C-Level</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Middle Management" /> <label>Middle Management</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Staff" /> <label>Staff</label>
                        </div>
                      </div>
                      <div class="dropdown-item-selection active"></div>
                    </div>
                    <div class="dropright">
                      <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <input type="checkbox" value="geography" /> <label>Geography</label>
                        <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="dropdown-menu dropdown-menu--submenu">
                        
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="United States" /> <label>United States</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="China" /> <label>China</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="Germany" /> <label>Germany</label>
                        </div>
                        
                        
                        </div>
                      <div class="dropdown-item-selection active"></div>
                    </div>
                    <div class="dropright">
                      <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <input type="checkbox" value="tenure" /> <label>Tenure</label>
                        <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="dropdown-menu dropdown-menu--submenu">
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                        </div>
                        <div class="dropdown-item md-cb">
                          <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                        </div>
                      </div>
                      <div class="dropdown-item-selection active"></div>
                    </div>
                  </div>
                </div>

                <!-- Trigger Modals -->
                <div class="sidepanel sidepanel--action clearfix js-action-panel">

                  <div class="dropdown-menu show">
                    <h6 class="dropdown-header">Go to:</h6>

                    <button type="button" class="dropdown-item js-hook" data-filter="true" data-url="details.html" data-tab="nav-cat">
                      <i class="icon icon--eye"></i>
                      <label>All Categories</label>
                    </button>

                    <button type="button" class="dropdown-item js-hook" data-filter="true" data-url="details.html" data-tab="nav-questions">
                      <i class="icon icon--question"></i>
                      <label>All Questions</label>
                    </button>

                    <button type="button" class="dropdown-item js-hook" data-filter="true" data-url="details.html" data-tab="nav-questions" data-modal="modalAllQuestionFilter" data-tag="questions-not-on-chart">
                      <i class="icon icon--question"></i>
                      <label>Questions not on<br>this chart</label>
                    </button>
                    
                  </div>
                  
                </div>

              </div>


              <!-- Insights Content -->
              <div class="col-9 insights-content">
                
                <div class="row insights-content__text">
                  <div class="col-10">
                    <p>Gain more insights about your organization’s performance in each category (measured on a scale from 0 to 100%). Every slice in the circular diagram corresponds to one survey question. The better your organization scores on a question, the larger the slice is. The smaller slices indicate a weaker performance score.  Mouse over any slice to see the question and click to see the breakdown of responses. The navigation on the left-hand side allows you to focus on responses from specific parts of the organization (filter function).</p>
                  </div>
                  <div class="col-1">
                    <button class="btn btn-download" data-target="#sp_question_graph" data-html2canvas-ignore>
                      <i class="icon icon--download"></i>
                    </button>
                  </div>
                </div>

                <div class="row" id="sp_question_graph" html2canvas-no-padding>
                  <!-- Graph Info -->
                  <div class="insights-content__graphinfo graph-info position-absolute pr-md-2 pr-lg-3 js-question-graph-info w-50 text-right">
                    <!-- Filled using template -->
                  </div>

                  <!-- Graph -->
                  <div class="insights-content__graph mt-1" id="questions_graph">
                    <svg></svg>
                  </div>
                  
                </div>

              </div>
              
            </div>
            
          </div>

          <!-- Camera Button -->
          <button class="btn btn-camera js-btn-camera" data-target="#sp_question_graph">
            <i class="icon icon--camera"></i>
          </button>
          
        </div>

      </div>
      
    </main>

    <!-- Site Footer -->
    <footer>

      <div class="container">

        <p>© 2018 PwC. All rights reserved. PwC refers to the PwC network and/or one or more of its member firms, each of which is a separate legal entity. Please see <a href="www.pwc.com/structure">www.pwc.com/structure</a> for further details.</p>

        <nav class="nav">
          <a class="nav-link pl-0" href="#">Privacy policy</a>
          <a class="nav-link" href="#">Terms of use</a>
          <a class="nav-link" href="#">Cookies info</a>
          <a class="nav-link" href="#">About site provider</a>
        </nav>
        
      </div>
      
    </footer>


    <!-- Modals -->

    <!-- 1. Categories Modal -->
    <div class="modal fade js-modal-inclusive" id="modalCategories" tabindex="-1" role="dialog" aria-labelledby="modalCategoriesTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCategoriesTitle">Show/Hide Categories</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body p-0">
            
            <div class="container-fluid p-0">
              
              <div class="row justify-content-center m-0">
                                
                <div class="col sidepanel sidepanel--category clearfix m-0 p-0 js-category-panel">

                  <div class="dropdown-menu show m-0 border-0">
                    <h6 class="dropdown-header">Categories:</h6>
                    
                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Overall">
                      <label>Overall</label>
                    </div>

                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Value Proposition">
                      <label>Value Proposition</label>
                    </div>

                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Capabilities">
                      <label>Capabilities</label>
                    </div>

                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Portfolio">
                      <label>Portfolio</label>
                    </div>

                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Leadership">
                      <label>Leadership</label>
                    </div>

                    <div class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Impact">
                      <label>Impact</label>
                    </div>

                    
                  </div>
                                  
                </div>
                                
              </div>
              
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 2. Single Question Modal with Panel -->
    <div class="modal modal-fs fade" id="modalQuestionFilter" tabindex="-1" role="dialog" aria-labelledby="modalQuestionFilterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

          <div class="modal-body">
            
            <div class="container-fluid">
              
              <div class="row">
                                
                <div class="col-md-auto">

                  <!-- Filters -->
                  <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Filter for:</h6>
                      <div class="dropright">
                        
                        <div class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="year" checked /> <label>Year</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="2018" checked /> <label>2018</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="2017" /> <label>2017</label>
                          </div>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">2018</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="org_unit" /> <label>Org. Unit</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Org. Unit 1" /> <label>Org. Unit 1</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Org. Unit 2" /> <label>Org. Unit 2</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Org. Unit 3" /> <label>Org. Unit 3</label>
                          </div>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <div class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="management" checked /> <label>Management Level</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="C-Level" checked /> <label>C-Level</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Middle Management" checked /> <label>Middle Management</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="Staff" /> <label>Staff</label>
                          </div>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">C-Level</span>
                          <span class="dropdown-item-text">Middle Management</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="geography" /> <label>Geography</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu"></div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="tenure" /> <label>Tenure</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                          </div>
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                          </div>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright hide">
                        <div class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="question" checked /> <label>Question</label>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <div class="dropdown-item md-cb">
                            <input type="checkbox" value=""  /> <label></label>
                          </div>
                        </div>
                        <div class="dropdown-item-selection active">
                          <!-- When a question is clicked on the Graph, its key is placed here -->
                          <span class="dropdown-item-text" id="selected_question"></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Categories -->
                  <div class="sidepanel sidepanel--breakdownby clearfix js-breakdownby-panel">
                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Breakdown by:</h6>
                      <div class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="year" /> <label>Year</label>
                        <span class="md-cb__unset js-md-cb-reset">&times;</span>
                      </div>
                      <div class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="org_unit" /> <label>Org. Unit</label>
                        <span class="md-cb__unset js-md-cb-reset">&times;</span>
                      </div>
                      <div class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="management" /> <label>Management Level</label>
                        <span class="md-cb__unset js-md-cb-reset">&times;</span>
                      </div>
                      <div class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="tenure" checked /> <label>Tenure</label>
                        <span class="md-cb__unset js-md-cb-reset">&times;</span>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="col">

                  <div class="row">

                    <p class="text-justify col"><b class="mr-1">How to use:</b> The below charts show how respondents answered your chosen question. Use the navigation on the left-hand side to only consider respondents from specific parts of the organization (filter function) and to compare responses of different sub-segments of the organization (breakdown function).</p>

                    <div class="col-md-auto p-2">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    
                  </div>
                 
                  <!-- Question and its Graph -->
                  <div class="js-modal-question graph-single-question" id="questions_list">
                    
                  </div>

              </div>
              
            </div>
          </div>
          
          </div>
        </div>
      </div>
    </div>

    <!-- Tooltip holder -->
    <div id="tooltip" class="tooltip shadow"></div>

    <!-- Template -->
    <!-- Overall template for Dashboard -->
    <script type="text/html" id="tpl_perf_info">
      <div style="font-size: 1.4rem; line-height: 1; font-weight:700;">Overall</div>
      <div class="graph-info__value ml-2 mr-3">{{value}}</div>
      <div class="graph-info__benchmark">
        <div class="hl-indicator graph-info__benchmarkr1">
          <span class="hl-indicator__figure mr-0">{{movement}}</span>
          <i class="hl-indicator__indicator {{#indicator}}text-success{{/indicator}} {{^indicator}}text-danger{{/indicator}}">
            <!--<i class="fas fa-caret-{{#indicator}}up{{/indicator}} {{^indicator}}down{{/indicator}}"></i>-->
            {{#indicator}}▲{{/indicator}}{{^indicator}}▼{{/indicator}}
          </i>
          <span>vs.</span>
          <span class="hl-indicator__year">{{prevYear}}</span>
        </div>
        <div class="graph-info__benchmarkr2">
          Benchmark: {{benchmark}}
        </div>
      </div>
    </script>

    <!-- Overall Performance template for Insights -->
    <script type="text/html" id="tpl_perf_info_insights">
      <div class="graph-info__value">
        <b>Overall Performance: {{value}}</b>
      </div>
      <div class="graph-info__benchmark">
        <div class="hl-indicator graph-info__benchmarkr1 mb-0">
          <span class="hl-indicator__figure mr-0">{{movement}}</span>
          <i class="hl-indicator__indicator {{#indicator}}text-success{{/indicator}} {{^indicator}}text-danger{{/indicator}}">
            <!--<i class="fas fa-caret-{{#indicator}}up{{/indicator}} {{^indicator}}down{{/indicator}}"></i>-->
            {{#indicator}}▲{{/indicator}}{{^indicator}}▼{{/indicator}}
          </i>
          <span>vs.</span>
          <span class="hl-indicator__year">{{prevYear}}</span>
        </div>
        {{#bFilterOrgActive}}
        <div class="graph-info__benchmarkr2">
          All Organization: {{allOrgValue}}
        </div>
        {{/bFilterOrgActive}}
        <div class="graph-info__benchmarkr2">
          Benchmark: {{benchmark}}
        </div>
      </div>
    </script>

    <!-- Template of Performance by Table -->
    <script id="tpl_perf_table" type="text/html">

      <div class="tbl-fixed h-100">
        <div class="fix-column">
            <div class="thead">
                <span>{{breakdownBy}}</span>
            </div>
            <div class="tbody">
                {{#rows}}
                <div class="trow" data-org-unit="{{firstCol}}">
                    <span>{{firstCol}}</span>
                </div>
                {{/rows}}
                
            </div>
        </div>
        <div class="rest-columns">
            <div class="thead">
              {{#years}}
                <span>{{.}}</span>
              {{/years}}
            </div>
            <div class="tbody">
              {{#rows}}
              <div class="trow">
                  {{#otherCols}}
                  <span class="js-perf-row-click" data-org-unit="{{firstCol}}" data-year="{{year}}">
                    <b>{{value}}%</b>
                    <div class="tbar">
                      <div class="tbar__value" style="width: {{value}}%"></div>
                    </div>
                  </span>
                  {{/otherCols}}
              </div>
              {{/rows}}
            </div>
        </div>
      </div>
      
    </script>

    <!-- Template of Question Tooltip -->
    <script id="tpl_question_tooltip" type="text/html">
      <p class="mb-0 inline">
        <b class="mr-1">Q{{id}}:</b>
        {{key}}
      </p>
    </script>

    <!-- Template for a single question -->
    <script id="tpl_question" type="text/html">

      {{#questions}}

        <div class="alert alert-secondary" role="alert">
          <b class="mr-2">Q{{srno}}:</b>{{key}}
          <button class="btn btn-download" data-target="#questions_list" data-html2canvas-ignore>
            <i class="icon icon--download"></i>
          </button>
        </div>


        <div class="gq pl-3 pr-3" id="id-{{qid}}-{{kid}}">

          <!-- Breakdown By Rows -->
          {{#values}}
          <div class="row gq-tuple align-items-center" data-id="{{qid}}-{{kid}}">
            <div class="col-3 gq-tuple__title">
              <label>{{key}}</label>
            </div>
            <div class="col gq-tuple__graph">
              
            </div>
          </div>
          {{/values}}

          <!-- Legend -->
          <div class="row gq-tuple" data-id="{{qid-kid}}">
            <div class="col-3"></div>
            <div class="col gq-tuple__legend"></div>
          </div>
          
        </div>

      {{/questions}}
      
    </script>

    <!-- Template for Participants section -->
    <script id="tpl_participants" type="text/html">

      <div class="col">
        <div class="row">

          <div class="col-md-auto">
            <label>Rate:</label>
            <span class="pc-indicator__rt">{{rate}}%</span>
          </div>

          <div class="col col-sm-auto">
            <!-- <label>Progress:</label> -->
            <span class="pc-indicator__pg">{{progressValue}}%</span>
            <span class="pc-indicator__pgindicator text-{{#progressMovementUp}}success{{/progressMovementUp}}{{^progressMovementUp}}danger{{/progressMovementUp}}">
              <!--
              <i class="fas fa-caret-{{#progressMovementUp}}up{{/progressMovementUp}}{{^progressMovementUp}}down{{/progressMovementUp}}"></i>
              -->
              {{#progressMovementUp}}▲{{/progressMovementUp}}
              {{^progressMovementUp}}▼{{/progressMovementUp}}
            </span>
            <span>vs.</span>
            <span class="pc-indicator__pgyear">{{progressYear}}</span>
          </div>

          <div class="col-md-auto">
            <label>Benchmark:</label>
            <span class="pc-indicator__bm">{{benchmark}}%</span>
          </div>
          
        </div>

      </div>

      <div class="col">
        {{#figureValue}}
        <span class="pc-indicator__icon text-danger">
          <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> <!-- Created with Method Draw - http://github.com/duopixel/Method-Draw/ --> <g> <g id="svg_1"> <path d="m0,0l0,101.000002l15.618055,0l2.875,-22.654862c1.229167,-3.766458 4.166667,-6.761389 7.888889,-8.037917l14.958333,-5.134167c0.173611,-0.056111 0.375,-0.014028 0.5,0.119236l1.166667,1.213403c1.854167,1.921806 4.333333,2.980903 6.993055,2.980903c2.659722,0 5.138889,-1.059097 6.993055,-2.980903l1.166667,-1.213403c0.131944,-0.133264 0.326389,-0.182361 0.5,-0.119236l14.958333,5.134167c3.722222,1.276528 6.659722,4.271458 7.888889,8.037917l2.875,22.654862l15.618055,0l0,-101.000002l-99.999999,0l0.000001,0zm95.743054,96.700488l-7.597222,0l-2.416667,-19.091806l-0.083333,-0.371736c-1.604167,-5.148195 -5.583333,-9.258334 -10.638889,-10.997778l-14.958333,-5.134167c-1.722222,-0.589167 -3.659722,-0.119236 -4.930555,1.199375l-1.166667,1.213403c-1.041667,1.080139 -2.4375,1.676319 -3.9375,1.676319c-1.493056,0 -2.895833,-0.596181 -3.9375,-1.676319l-1.166667,-1.213403c-1.270833,-1.318611 -3.208333,-1.788542 -4.930555,-1.199375l-14.958333,5.134167c-5.0625,1.739444 -9.041667,5.849583 -10.638889,10.997778l-2.5,19.463542l-7.597222,0l0,-92.386946l91.472221,0l0,92.386946l-0.013889,0zm-45.73611,-37.882015c4.159722,0 6.534722,-2.300556 9,-5.08507c3,-3.387708 4.513889,-9.21625 4.513889,-17.33132c0,-8.283403 -6.0625,-15.02375 -13.513889,-15.02375c-7.451389,0 -13.513889,6.740347 -13.513889,15.02375c0,8.11507 1.520833,13.943611 4.513889,17.33132c2.465278,2.7775 4.840278,5.08507 9,5.08507m0,-33.133612c5.097222,0 9.25,4.804514 9.25,10.710209c0,6.824514 -1.222222,11.958681 -3.430556,14.462639c-2.534722,2.868681 -3.784722,3.647222 -5.819444,3.647222c-2.034722,0 -3.284722,-0.785556 -5.819444,-3.647222c-2.215278,-2.503958 -3.430556,-7.638125 -3.430556,-14.462639c0,-5.905695 4.145833,-10.710209 9.25,-10.710209" id="svg_2" stroke="null" fill="#d93954"/> </g> </g> </svg>
        </span>
        {{/figureValue}}
        {{#figureValueInverse}}
        <span class="pc-indicator__icon text-secondary">
          <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> <!-- Created with Method Draw - http://github.com/duopixel/Method-Draw/ --> <g> <g id="svg_1"> <path d="m0,0l0,101.000002l15.618055,0l2.875,-22.654862c1.229167,-3.766458 4.166667,-6.761389 7.888889,-8.037917l14.958333,-5.134167c0.173611,-0.056111 0.375,-0.014028 0.5,0.119236l1.166667,1.213403c1.854167,1.921806 4.333333,2.980903 6.993055,2.980903c2.659722,0 5.138889,-1.059097 6.993055,-2.980903l1.166667,-1.213403c0.131944,-0.133264 0.326389,-0.182361 0.5,-0.119236l14.958333,5.134167c3.722222,1.276528 6.659722,4.271458 7.888889,8.037917l2.875,22.654862l15.618055,0l0,-101.000002l-99.999999,0l0.000001,0zm95.743054,96.700488l-7.597222,0l-2.416667,-19.091806l-0.083333,-0.371736c-1.604167,-5.148195 -5.583333,-9.258334 -10.638889,-10.997778l-14.958333,-5.134167c-1.722222,-0.589167 -3.659722,-0.119236 -4.930555,1.199375l-1.166667,1.213403c-1.041667,1.080139 -2.4375,1.676319 -3.9375,1.676319c-1.493056,0 -2.895833,-0.596181 -3.9375,-1.676319l-1.166667,-1.213403c-1.270833,-1.318611 -3.208333,-1.788542 -4.930555,-1.199375l-14.958333,5.134167c-5.0625,1.739444 -9.041667,5.849583 -10.638889,10.997778l-2.5,19.463542l-7.597222,0l0,-92.386946l91.472221,0l0,92.386946l-0.013889,0zm-45.73611,-37.882015c4.159722,0 6.534722,-2.300556 9,-5.08507c3,-3.387708 4.513889,-9.21625 4.513889,-17.33132c0,-8.283403 -6.0625,-15.02375 -13.513889,-15.02375c-7.451389,0 -13.513889,6.740347 -13.513889,15.02375c0,8.11507 1.520833,13.943611 4.513889,17.33132c2.465278,2.7775 4.840278,5.08507 9,5.08507m0,-33.133612c5.097222,0 9.25,4.804514 9.25,10.710209c0,6.824514 -1.222222,11.958681 -3.430556,14.462639c-2.534722,2.868681 -3.784722,3.647222 -5.819444,3.647222c-2.034722,0 -3.284722,-0.785556 -5.819444,-3.647222c-2.215278,-2.503958 -3.430556,-7.638125 -3.430556,-14.462639c0,-5.905695 4.145833,-10.710209 9.25,-10.710209" id="svg_2" stroke="null"/> </g> </g> </svg>
        </span>
        {{/figureValueInverse}}
      </div>
      
    </script>

    <!-- Template for highlights -->
    <script id="tpl_highlights" type="text/html">

      {{#highlights}}
      <div class="hl-indicator cursor-p pr-lg-5" data-question="{{question}}">

        <h6 class="hl-indicator__title">{{title}}</h6>

        <p class="hl-indicator__content">{{question}}</p>

        <div class="row justify-content-start mt-2">

          <div class="col-4 col-sm-6">
            <span class="hl-indicator__figure">{{value}}%</span>
            <span class="hl-indicator__term">{{text}}</span>
          </div>

          <div class="col-4 col-sm-6">
            <span class="hl-indicator__figure">{{indicatorValue}}%</span>
            <span class="hl-indicator__indicator text-{{#indicatorMovementUp}}success{{/indicatorMovementUp}}{{^indicatorMovementUp}}danger{{/indicatorMovementUp}}">
              <!--
              <i class="fas fa-caret-{{#indicatorMovementUp}}up{{/indicatorMovementUp}}{{^indicatorMovementUp}}down{{/indicatorMovementUp}}"></i>
              -->
              {{#indicatorMovementUp}}▲{{/indicatorMovementUp}}
              {{^indicatorMovementUp}}▼{{/indicatorMovementUp}}
            </span>
            <span>vs.</span>
            <span class="hl-indicator__year">{{indicatorYear}}</span>
          </div>
          
        </div>
        
      </div>
      {{/highlights}}
      
    </script>

    <script>
      if (typeof Promise !== "function"){
        document.write('<script src="js/es6-promise.auto.min.js"><\/script>');
      }
      if (typeof fetch !== "function"){
        document.write('<script src="js/fetch-2.0.4.min.js"><\/script>');
      }
    </script>
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="js/d3.5.7.0.min.js"></script>
    <script src="js/d3-legend.min.js"></script>
    <script src="js/jspdf.min.js"></script>
    <script>
      // IE 11
      if (!!window.MSInputMethodContext && !!document.documentMode){
        document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"><\/script>');
        document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.svg.min.js"><<\/script>');
      }else{
        document.write('<script src="js/html2canvas.min.js"><\/script>');
      }
    </script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
    $(function() {

      // Sample Dataset - Performace Category Graph
      // 

      var categoryData = [{
        name: "Value Proposition",
        color: "#ec9ca9",
        value: 1,
        // actual percentage
        depth: 61,
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Capabilities",
        color: "#f5c57f",
        value: 1,
        depth: 31,
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Portfolio",
        color: "#ffe9b2",
        value: 1,
        depth: 94,
        indicator: -1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Leadership",
        color: "#f3aca5",
        value: 1,
        depth: 67,
        indicator: -1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Impact",
        color: "#e3bcbc",
        value: 1,
        depth: 26,
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }];

      var progressData = [{
        // Mention the progress value here = 100 - progress value
        name: "noprogress",
        value: 46
      }, {
        // Mention the progress value here
        name: "progress",
        value: 54
      }];

      var overallData = {
        value: '54%',
        allOrgValue: '85%',
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      };

      // Performance breakdown by Category - Table Data 
      var tableData = {
        breakdownBy: "Org. Unit",
        years: [2018, 2017],
        rows: d3.range(1,15).map(function(d){
          return d == 1 ? {
            firstCol: "All",
            otherCols: [{
              value: 78,
              year: 2018
            }, {
              value: 89,
              year: 2017
            }]
          }: {
            firstCol: "Org. Unit " + d,
            otherCols: [{
              value: 45,
              year: 2018
            }, {
              value: 59,
              year: 2017
            }]
          };
        })
      };

      // Benchmark data for Questions Graph
      // The value of name property should match
      // categories defined in the raw dataset
      //  
      var benchmarkData = {
        
        "Value Proposition": {
          color: "#ec9ca9",
          value: "23%",
          allOrgValue: '45%',
          // 1 for Up -1 for false
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
        }, 
        "Capabilities": {
          color: "#f5c57f",
          value: "23%",
          allOrgValue: '45%',
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Portfolio": {
          color: "#ffe9b2",
          value: "23%",
          allOrgValue: '45%',
          indicator: -1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Leadership": {
          color: "#f3aca5",
          value: "23%",
          allOrgValue: '45%',
          indicator: -1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Impact": {
          color: "#e3bcbc",
          value: "23%",
          allOrgValue: '45%',
          // 1 for Up -1 for false
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
        }
      };


      // Data for Participants section
      // 
      var participantsData = {
        rate: 54,
        benchmark: 59,
        progressValue: 8,
        progressMovement: 5,
        // if positive movement, otherwise false
        progressMovementUp: true,
        progressYear: 2017
      };

      // Data for highlights section
      // 
      var highlightsData = [{
          title: "Most Positive",
          question: "Do you think your company has a clear value proposition?",
          value: 70,
          text: "fully agree",
          indicatorValue: 10,
          indicatorMovementUp: true,
          indicatorYear: 2017
        },{
          title: "Biggest concern about strategy",
          question: "Value proposition is not differentiated.",
          value: 85,
          text: "concerned",
          indicatorValue: 10,
          indicatorMovementUp: false,
          indicatorYear: 2017
        },{
          title: "Biggest improvement",
          question: "Do you understand the strategy?",
          value: 60,
          text: "fully agree",
          indicatorValue: 30,
          indicatorMovementUp: false,
          indicatorYear: 2017
        },{
          title: "Biggest concern about execution",
          question: "Budgets are not inline with the strategy.",
          value: 90,
          text: "concerned",
          indicatorValue: 30,
          indicatorMovementUp: true,
          indicatorYear: 2017
        }]

      // Template for question
      // 
      var tpl_question_tooltip = $('#tpl_question_tooltip').html();
      Mustache.parse(tpl_question_tooltip);

      var bDrawQuestionsTabGraph = false,
      aDataset = null,
      edispatch = d3.dispatch('dataLoaded', 'tabOpened');

      // Category Graph - Aster Chart
      // 
      function drawCategroyGraph(progressData, data) {
        
        var target = '#perf_cat_graph svg';

        var totalRings = 7,
          width = $(target).width(),
          height = $(target).height(),
          maxRadius = Math.min(width, height) / 2,
          outerArcRadius = maxRadius * (data.length + 1) / totalRings,
          radius = maxRadius * data.length / totalRings,
          arcRadius = radius * 0.6;

        var pie = d3.pie()
          .sort(null)
          .value(function(d) {
            return d.value;
          });

        var arcLabel = d3.arc()
          .innerRadius(arcRadius)
          .outerRadius(arcRadius);

        var progressArc = d3.arc()
          .innerRadius(outerArcRadius)
          .outerRadius(maxRadius);

        var fullArc = d3.arc()
          .innerRadius(0)
          .outerRadius(outerArcRadius);

        var radiusScale = d3.scaleLinear()
          .domain([0, 100])
          .range([1, radius - 1]);

        function fnOuterRadius(d) {
          return radiusScale(d.data.depth);
        }

        var arc = d3.arc()
          .innerRadius(0)
          .outerRadius(fnOuterRadius);

        var chartData = pie(data),
          progressData = pie(progressData),
          ringCount = d3.range(chartData.length + 1),
          ringRadius = Math.round(radius / chartData.length);


        var arcs = chartData;
        var firstArcSection = /(^.+?)L/;
        var adeg = Math.PI / 180;
        var svg = d3.select(target)
          //.attr("viewBox", [-(width / 2), -(height / 2), width, height])
          //.attr("preserveAspectRatio", "xMidYMid meet")
          .attr("text-anchor", "middle");

        var g = svg.append("g")
          //.attr("transform", 'translate(0,0)');
          .attr("transform", 'translate(' + (width / 2) + ', ' + (height / 2) + ')');

        // Create Arcs/slices
        var gArcs = g.append("g")
          .classed("g-arcs", true);

        gArcs.selectAll("path")
          .data(arcs)
          .enter().append("path")
          .attr("fill", function(d){ 
            return d.data.color; 
          })
          //.attr("fill-opacity", 0.8)
          .attr("stroke", "none")
          .attr("d", arc);

        // Create concentric rings
        var gRings = g.append("g")
          .classed("g-rings", true)
          .selectAll("circle")
          .data(ringCount);

        gRings.enter().append("circle")
          .attr("r", function(d) {
            return d * ringRadius;
          })
          .attr("fill", "none")
          .attr("stroke", function(d, i) {
            // make last ring black, rest white
            return i == (ringCount.length - 1) ? "#222" : "white";
          })
          .attr("stroke-width", 1);

                // Create full slices
        var gFullArcs = g.append("g")
          .classed("g-fullarcs", true);

        gFullArcs.selectAll("path")
          .data(arcs)
          .enter().append("path")
          .attr("fill", "none")
          .attr("stroke", "#333")
          .attr("d", fullArc)
          .each(function(d, i) {
            // setup arc label path
            // 
            var newArc = firstArcSection.exec(d3.select(this).attr("d"))[1],
              newArc = newArc.replace(/,/g, " ");
            
            //If the end angle lies beyond a quarter of a circle (90 degrees or pi/2)
            //flip the end and start position
            if (d.endAngle > 90 * adeg && d.endAngle < 300 * adeg) {
              //Everything between the capital M and first capital A
              var startLoc = /M(.*?)A/;
              //Everything between the capital A and 0 0 1
              var middleLoc = /A(.*?)0 0 1/;
              //Everything between the 0 0 1 and the end of the string (denoted by $)
              var endLoc = /0 0 1 (.*?)$/;
              //Flip the direction of the arc by switching the start and end point
              //and using a 0 (instead of 1) sweep flag
              var newStart = endLoc.exec(newArc)[1];
              var newEnd = startLoc.exec(newArc)[1];
              var middleSec = middleLoc.exec(newArc)[1];

              //Build up the new arc notation, set the sweep-flag to 0
              newArc = "M" + newStart + "A" + middleSec + "0 0 0 " + newEnd;
            } 

            gFullArcs.append("path")
              .attr("class", "hiddenArcs")
              .attr("id", "labelArc" + i)
              .attr("d", newArc)
              .style("fill", "none");
          })



        //Append the label names on the outside
        gFullArcs.selectAll(".arcText")
          .data(arcs)
          .enter().append("text")
          .attr("class", "arcText")
          //Move the labels below the arcs for slices with an end angle > than 90 degrees
          .attr("dy", function(d, i) {
            return 3 + ((d.endAngle > 90 * adeg && d.endAngle < 300 * adeg) ? -ringRadius / 2 : ringRadius / 2);
          })
          .append("textPath")
          .attr("startOffset", "50%")
          .style("text-anchor", "middle")
          .attr("xlink:href", function(d, i) { return "#labelArc" + i; })
          .text(function(d){ 
            return d.data.name;
          });

        var gText = g.append("g")
          .classed("g-text", true);

        var text = gText.selectAll("text")
          .data(arcs)
          .enter().append("text")
          .style("font-size", "0.75rem")
          .attr("transform", function(d){ 
            return 'translate(' + arcLabel.centroid(d) + ')'; })
          .attr("dy", "0.35em");

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "-0.5em")
          .style("font-size", "1.5rem")
          .style("font-weight", "bold")
          .text(function(d){ return d.data.depth + '%'; });

        text.append("tspan")
          .attr("x", "-2em")
          .attr("y", "0.7em")
          .text(function(d){ return d.data.movement; });

        text.append("tspan")
          .attr("x", "-0.75em")
          .attr("y", "0.7em")
          .attr("class", function(d){ return d.data.indicator > 0 ? 'up' : 'down'; })
          .text(function(d){ return d.data.indicator > 0 ? '▲' : '▼' });

        text.append("tspan")
          .attr("x", "1.75em")
          .attr("y", "0.7em")
          .text(function(d){ return ('vs. ' + d.data.prevYear); });

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "1.7em")
          .text(function(d){ return  'Benchmark: ' + d.data.benchmark; });

        // Progress Arc
        g.append("g")
          .classed("progress-arc", true)
          .selectAll("path")
          .data(progressData)
          .enter().append("path")
          .attr("d", progressArc)
          .attr("fill", function(d, i) {
            // Not the first one
            return i > 0 ? "#222" : "none";
          })
          .classed("progress-arc-path", function(d, i) {
            // Not the first one
            return i > 0;
          });


        // Handle size
        // 
        var bbox = svg.node().getBBox();        
        svg
          .attr("class", "graph-svg")
          .attr("width", bbox.width)
          .attr("height", bbox.height)
          .style("width", bbox.width+'px')
          .style("height", bbox.height+'px')
          .attr("viewBox", [0, 0, bbox.width, bbox.height])
          .attr("preserveAspectRatio", "xMidYMid meet");
        

        g.attr("transform", 'translate(' + (bbox.width / 2) + ', ' + (bbox.height / 2) + ')');
        
        // bind resize to set graph dimensions
        // 
        $( window ).resize(function() {
          // only if details tab is active
          // 
          if (!bDrawQuestionsTabGraph) {
            var parentbox = $(target).parent()[0].getBoundingClientRect(),
            size = Math.min(parentbox.width, parentbox.height);

            svg
              .attr("width", size)
              .attr("height", size)
              .style("width", size+'px')
              .style("height", size+'px');
          }
            
        });

        // bind click event
        // 
        svg.on('click', function(){
          goToTab('nav-insights', {
            year: '2018'
          });
        });


      }

      // Select a tab and set filter settings
      function goToTab(sTabId, oFilterSettings) {
        selectTab(sTabId);
        initFilters(oFilterSettings);
      }

      // Category Graph - Table
      // 
      function drawCategoryTable(tableData) {

        var target = $('#perf_cat_table'),
        tpl = $('#tpl_perf_table').html();

        Mustache.parse(tpl);

        target.html(Mustache.render(tpl, tableData));

        initTableFixed();

        // Bind click events
        // 
        target.find('.js-perf-row-click').on('click', function(){

          var oData = $(this).data();

          goToTab('nav-insights', {
            year: oData.year.toString(),
            org_unit: oData.orgUnit
          });

        })
        
      }

      // Question Graph - Insights
      // 
      function drawQuestionsGraph(benchmarkData, progressData, aData, bFilterOrgActive) {

        var target = '#questions_graph svg';

        $(target).html('');

        var width = $(target).width(),
          height = $(target).height(),
          iReduceRadiusBy = 40,
          maxWidth = Math.min(width, height),
          width = maxWidth - 150,
          radius = width / 3,
          outerRadius = radius + 5 - iReduceRadiusBy,
          outerArcRadius = outerRadius + 20,
          maxRadius = outerArcRadius + 40,
          labelRadius = maxRadius + 40,
          adeg = Math.PI/180,
          ringData = d3.range(1, aData.length),
          ringRadius = (radius - iReduceRadiusBy - 1) / aData.length;
        
        var qdata = d3.merge(aData.map(function(d){
          return d.values.map(function(dv){
            dv.name = d.key;
            return dv;
          });
        }));

        var cqdata = aData.map(function(d){
          var obj = {};
          obj.key = d.key;
          // equal slices
          obj.value = d.values.length; //d3.sum(d.values, function(dv){ return dv.value; });
          return obj;
        });

        var pie = d3.pie()
        .sort(null)
        .value(function(d) {
          return d.value;
        });
        
        var fullArc = d3.arc()
        .innerRadius(0)
        .outerRadius(maxRadius);

        var arcLabel = d3.arc()
          .innerRadius(labelRadius)
          .outerRadius(labelRadius);

        var progressData = pie(progressData);

        var y = d3.scaleLinear()
          .range([0, radius]);

        var x = d3.scaleLinear()
          .range([0, 2 * Math.PI]);

        var qPie = d3.pie()
        .sort(null)
        .value(function(d) {
          // equal slices
          return 1; //d.value;
        });
        
        var radiusScale = d3.scaleLinear()
        //.domain([0, d3.max(qdata, function(d){ return d.value; })])
        // Values are assumed to be in percentage. Max value is 100
        .domain([0, 100])
        .range([1, radius - iReduceRadiusBy - 1]);
        
        function fnOuterRadius(d) {
          return radiusScale(d.data.value);
        }
        
        var qarc = d3.arc()
        .innerRadius(0)
        .outerRadius(fnOuterRadius);
        
        var qPieData = qPie(qdata);

        // Add Pie arcs
        var pieData = pie(cqdata);

        function getBenchmarkData(sCategory) {
          return benchmarkData[sCategory] || {

          };
        }

        var svg = d3.select(target)
        .classed('js-skip-viewbox-auto-adjust', true)
        .style("width", maxWidth+'px')
        .style("height", maxWidth+'px');
        
        svg.selectAll('g')
          .remove();      
  
        var g = svg.append("g")
        .attr("transform", 'translate(' + (maxWidth / 2) + ', ' + /*(maxWidth / 2)*/ labelRadius + ')');

        g.append("g")
        .classed("g-slices", true)
        .selectAll("path")
        .data(qPieData)
        .enter().append("path")
          .attr("fill", function(d){
            return getBenchmarkData(d.data.name).color; 
          })
          .attr("stroke", "#ffffff")
          .attr("stroke-width", 1)
          .attr("d", qarc)
          .on('mouseover', showTooltip)
          .on('mouseout', hideTooltip)
          .on('click', function(d){
            onShowQuestion(d.data.key);
          });
        
        // Create concentric rings
        var gRings = g.append("g")
          .classed("g-rings", true)
          .selectAll("circle")
          .data(ringData);

        gRings.enter().append("circle")
          .attr("r", function(d) {
          return d * ringRadius;
        })
        .attr("fill", "none")
        .attr("stroke", "#fff")
        .attr("stroke-width", 1);
        
        
          // Create full slices
        var gFullArcs = g.append("g")
          .classed("g-fullarcs", true);
        
        gFullArcs.selectAll("path")
          .data(pieData)
          .enter().append("path")
            .attr("fill", "none")
            .attr("stroke", "#333")
            .attr("d", fullArc);
        
        gFullArcs.append("circle")
          .attr("r", outerRadius)
          .attr("stroke", "black")
          .attr("fill", "none")
          .attr("stroke-width", 1);
        
        // Add a Circl with white stroke to hide the full arc slices' outer edge
        gFullArcs.append("circle")
          .attr("r", maxRadius)
          .attr("stroke", "white")
          .attr("fill", "none")
          .attr("stroke-width", 5);
        
        var progressArc = d3.arc()
        .innerRadius(outerRadius)
        .outerRadius(outerArcRadius);
        
        // Progress Arc
        g.append("g")
        .classed("progress-arc", true)
        .selectAll("path")
        .data(pie(progressData))
        .enter().append("path")
        .attr("d", progressArc)
        .attr("fill", function(d, i){
          // Not the first one
          return i > 0 ? "#222": "none";
        })
        .classed("progress-arc-path", function(d, i){
          // Not the first one
          return i > 0;
        });

        var gText = g.append("g")
          .classed("g-text", true);

        function isRight(d){
          return (d.startAngle < 120 * adeg);
        }

        var text = gText.selectAll("text")
          .data(pieData)
          .enter().append("text")
          .attr("text-anchor", function(d){
            return isRight(d) ? "end" : "start";
          })
          .style("font-size", "0.875rem")
          .style("font-family", "Arial")
          .attr("transform", function(d, i){ 
            var cd = arcLabel.centroid(d),
            topMargin = 90,
            axisMarginTop = 160,
            axisMarginBottom = 100,
            labelBoxSize = maxWidth - 50;
            
            // along a circular arc
            cd[0] = cd[0] + (cd[0] > 0 ? 100 : -100) * (i == 2 ? 0 : 1);
            
            /**
             * The placement of each label is as follows: - 
             * Consider a square perimeter of the graph along which labels will be places. Starting point is top,left 0,0.
             * 
             * s - side of the square
             * r - s/2
             * 
             * 1. Along X axis between s/2,0 to s,0
             * 2. Along Y axis between s,s/5 to s,s-s/5
             * 3. Along X axis between s/5,s to s-s/5,s
             * 4. Along Y axis between 0, s/5 to 0, s-s/5
             * 5. Along X axis between 0,0 to s/2,0
             * 
             */
            switch(i){

              case 0:
                cd[0] = labelBoxSize/2;
                cd[1] = -labelRadius + topMargin;
                break;

              case 1:
                cd[0] = labelBoxSize/2;
                // 2. Along Y axis between s,s/5 to s,s
                // 
                var ceil = -labelRadius + axisMarginTop,
                floor = labelRadius - axisMarginBottom;
                
                if (cd[1] < ceil) {
                  cd[1] = ceil;
                }else if (cd[1] > floor) {
                  cd[1] = floor;
                }

                break;

              case 2:
                cd[1] = labelRadius;
                break;

              case 3:
                cd[0] = -labelBoxSize/2;
                // 2. Along Y axis between s,s/5 to s,s
                // 
                var ceil = -labelRadius + axisMarginTop,
                floor = labelRadius - axisMarginBottom;
                
                if (cd[1] < ceil) {
                  cd[1] = ceil;
                }else if (cd[1] > floor) {
                  cd[1] = floor;
                }

                break;

              case 4:
                cd[0] = -labelBoxSize/2;
                cd[1] = -labelRadius + topMargin;
                break;

            }

            return 'translate(' + cd + ')'; 
          })
          .attr("dy", "0.35em");

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "-0.7em")
          .style("font-size", "1rem")
          .style("font-weight", "bold")
          .text(function(d){ return d.data.key + ': ' + getBenchmarkData(d.data.key).value; });

        text.append("tspan")
          .attr("x", function(d){
            return isRight(d) ? "-5em" : 0;
          })
          .attr("y", "0.7em")
          .text(function(d){ return getBenchmarkData(d.data.key).movement; });

        text.append("tspan")
          .attr("x", function(d){
            return isRight(d) ? "-4em" : "1.65em";
          })
          .attr("y", "0.7em")
          .attr("class", function(d){ return getBenchmarkData(d.data.key).indicator > 0 ? 'up' : 'down'; })
          .text(function(d){ return getBenchmarkData(d.data.key).indicator > 0 ? '▲' : '▼' });

        text.append("tspan")
          .attr("x", function(d){
            return isRight(d) ? 0 : "2.75em";
          })
          .attr("y", "0.7em")
          .text(function(d){ return ('vs. ' + getBenchmarkData(d.data.key).prevYear); });

        if (bFilterOrgActive) {

          text.append("tspan")
            .attr("x", 0)
            .attr("y", "1.7em")
            .text(function(d){ return  'All Organization: ' + getBenchmarkData(d.data.key).allOrgValue; });

        }
        overallData.bFilterOrgActive = bFilterOrgActive;

        text.append("tspan")
          .attr("x", 0)
          .attr("y", bFilterOrgActive ? "2.8em" : "1.7em")
          .text(function(d){ return  'Benchmark: ' + getBenchmarkData(d.data.key).benchmark; });

        // Show overall info
        // 
        $('.js-question-graph-info').html(Mustache.render($('#tpl_perf_info_insights').html(), overallData));


        try {
          var elSvg = svg.node(),
          bb = elSvg.getBoundingClientRect(),
          padding = 0;
          elSvg.setAttribute("width", bb.width + padding);
          elSvg.setAttribute("height", bb.height + padding);
          elSvg.setAttribute("viewBox", [0, 0, bb.width, bb.height].join(' '))
        }catch(e){

        }

      }

      /**
       * Draw graphs for Selected Question modal
       * @param  {array of Objects} data dataset
       */
      function drawQuestionModalGraph(data, aBreakdownBy) {

        var oConfig,
        tpl = $('#tpl_question').html(),
        qData = [],
        qDataMap = {},
        target = $('#questions_list'),
        tData;

        function parseData(aData) {
          // Assign a unique id to every question
          // 
          var i = 0,
          j = 0,
          key;

          return aData.map(function(q, srno){

            q.qid = 'q-'+ ++i;
            q.srno = srno+1;

            // Assign an Id to every Key
            // Add a key for 'All'
            // 
            var iMaxKeyCount = d3.max(q.values, function(d){ return d.values.length; }),
            iMaxKeys,
            oAll;

            // Find out index of max keys
            // 
            q.values.forEach(function(d, i){
              iMaxKeys = d.values.length == iMaxKeyCount ? i : iMaxKeys;
            });

            oAll = {
              key: 'All',
              values: q.values[iMaxKeys].values.map(function(d){ return {key: d.key, value: 0}; })
            };

            q.values.unshift(oAll);

            q.values.map(function(k){

              k.kid = 'k-'+ ++j;

              key = q.qid + '-' + k.kid;
              
              qDataMap[key] = {
                category: 'Impact',
                values: k.values
              };

              // Add values to 'All' Key
              if (k.key != 'All') {
                k.values.forEach(function(kv, z){
                  oAll.values[z].value += kv.value;
                });
              }

              // filter undefined key
              k.values = k.values.filter(function(d){
                return d.key != 'undefined';
              });

              return k;

            });

            return q;
          });

        }

        qData = parseData(getStructuredData(data, aBreakdownBy));

        tData = {
          questions: qData
        };

        Mustache.parse(tpl);

        // Add HTML
        target.html(Mustache.render(tpl, tData));

        // Render Charts
        // 
        var aLegendData = [];
        target.find('.gq-tuple').each(function(){

          var row = $(this),
          id = row.data('id'),
          data = qDataMap[id],  // generateData(),
          el = row.find('.gq-tuple__graph'),
          elLegend = row.find('.gq-tuple__legend'),
          isGraph = !!el.length,
          isLegend = !!elLegend.length;
          
          if (isGraph) {

            StackedBar( oConfig = {
              el: el[0],
              width: el.width(),
              height: 40,
              barHeight: 20,
              data: data.values,
              category: data.category,
              colors: categoryColorMap[data.category]
            });
            // choose the data with max keys
            aLegendData = aLegendData.length < data.values.length ? data.values : aLegendData;

          }else if (isLegend) {

            drawLegend({
              el: elLegend[0],
              data: aLegendData,
              colors: categoryColorMap[oConfig.category],
              shapePadding: elLegend.width() / aLegendData.length
            });

          }

        });

        initDownloadHook();


      }

      // Render Participants Section
      // 
      function drawParticipants(data) {
        var target = $('#participants_section'),
        tpl = $('#tpl_participants').html(),
        iMaxFigures = 10,
        rValue;

        // calculate figureValue and figureValueInverse from data
        // 
        data.figureValue = d3.range(rValue = Math.round(+data.rate / 10));
        data.figureValueInverse = d3.range(iMaxFigures-rValue);

        target.html(Mustache.render(tpl, data));
        
      }

      // Render Highlights Section
      // 
      function drawHighlights(data) {
        var target = $('#highlights_section'),
        tpl = $('#tpl_highlights').html();

        target.html(Mustache.render(tpl, { highlights: data }));

        // On questions click, show its details
        // 
        $('#highlights_section .hl-indicator').on('click', function(){
          onShowQuestion($(this).data('question'));
        });
      }
      
      // Show tooltip
      function showTooltip(d) {
        
        $('#tooltip')
          .css('top', d3.event.pageY + 'px')
          .css('left',  d3.event.pageX + 'px')
          .html(Mustache.render(tpl_question_tooltip, d.data))
          .show();
      }

      // hide tooltip
      function hideTooltip() {
        $('#tooltip').hide();
      }

      // Open the Question details modal
      // 
      function onShowQuestion(id) {
        
        hideTooltip();

        // assign this id in the Filter panel
        // to enable data filtering
        // 
        $('#selected_question').html(id);

        // open the modal
        $('#modalQuestionFilter').modal('show');

        // trigger filter after modal is visible
        $('#modalQuestionFilter').off('shown.bs.modal');
        $('#modalQuestionFilter').on('shown.bs.modal', triggerFilter);

        function triggerFilter() {
          dispatch.call('getPanelSettings');
        }

      }

      /**
       * Process the raw dataset and breakdon into a structure
       * needed for our plotting purposes.
       * @param  {array} aData        raw dataset
       * @param  {array} aBreakdownBy an array of fields of the data in a sequence of structuring required, from top to bottom
       *                              default ['category', 'question', 'tenure', 'response'] i.e. responses breakdown by tenure
       * @return {array}             structured dataset
       */
      function getStructuredInsightsData(aData, aBreakdownBy /*, bRollup*/) {

        var nest = d3.nest(),
        bRollup = true,
        // sort based on following sequence
        sortBy = ['Strategy threesixty', 'Overall', 'Value Proposition', 'Capabilities', 'Portfolio', 'Leadership', 'Impact'],
        data;

        aBreakdownBy = aBreakdownBy || ['category', 'question'];

        aBreakdownBy.forEach(function(k){
          nest.key(function(d){ return d[k]; }).sortKeys(d3.ascending)
        });

        if (bRollup) {
          nest.rollup(function(response){ 
            return d3.mean(response, function(d){
              return parseFloat(d.value);
            });
          });
        }

        data = nest.entries(aData);

        // Sort the categories if that is the top level
        // 
        if (aBreakdownBy[0] == 'category') {
          data.forEach(function(d){
            d.sortIndex = sortBy.indexOf(d.key);
          });

          data.sort(function(a, b){
            return d3.ascending(a.sortIndex, b.sortIndex);
          });
        }

        return data;

      }

      // Read data File
      // 
      d3.json('data/data-new.json').then(function(data, error){
        if (error) {
          alert('Error reading data file.');
          return;
        }
        aDataset = data;

        edispatch.call('dataLoaded', null, data);

      });

        
      // Toggle Filter panels based on select tab: Categories or Insights
      // 
      $('.nav--sub a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

        edispatch.call('tabOpened', null, $(this).attr('href'));

        updatePageTitle($(this).text());

      });


      // Draw Questions Graph;
      // 
      edispatch.on('tabOpened', function(sTabId){

        // Questions Tab
        // 
        if (sTabId == '#nav-insights') {
          bDrawQuestionsTabGraph = true;
        }else{  // Dashboard tab
          bDrawQuestionsTabGraph = false;
        }

        // get active filters
        dispatch.call('getPanelSettings');

      });

      // On Data Loaded
      // 
      edispatch.on('dataLoaded', function(data){
        // get active filters
        // 
        dispatch.call('getPanelSettings');


        // Render
        //             
        drawCategroyGraph(progressData, categoryData);
        drawCategoryTable(tableData);
        drawHighlights(highlightsData);
        drawParticipants(participantsData);

        initJSHooks();
        fixSVGIconFill();

      });

      // On Filter Change
      // 
      dispatch.on('filter.questions', function(oSettings){

        if (!aDataset){
          return false;
        }

        // If Modal is open, Selected question tab
        // 
        if ($('#modalQuestionFilter.show').length) {

          // Update the graph based on new settings
          // 
          var aBreakdownBy = ['question', oSettings.breakdownBy, 'response'];

          // Filter the raw dataset and update
          // 
          drawQuestionModalGraph(filterData(aDataset, oSettings), aBreakdownBy);

        }else if (bDrawQuestionsTabGraph) { 

          // If Question Tab
          // 

          // Update the graph based on new settings
          // 
          var aBreakdownBy = ['category', 'question'];

          // Filter the raw dataset and update
          // 
          var bFilterOrgActive = !!oSettings.filters.filter(function(d){ return d.name == 'org_unit'; }).length;
          var qDataset = aDataset.filter(function(d){ return d.category != 'Overall'; });
          drawQuestionsGraph(benchmarkData, progressData, getStructuredInsightsData(filterData(qDataset, oSettings), aBreakdownBy), bFilterOrgActive);

          fixSVGIconFill();

        }


      });

      // Show Overall Info
      // 
      $('.js-perf-cat-graph-info').html(Mustache.render($('#tpl_perf_info').html(), overallData));
      

      // Bind Events
      // 
      $('.js-show-details').on('click', function(){

        $('#perf_cat_graph').toggleClass('show-details');

      });

      // Handler Drop Down dropdownCategory
      // 
      $('.js-dropdown-category .dropdown-menu .dropdown-item').on('click', function(){

        var item = $(this),
        itemValue = item.data('value'),
        btn = $('#dropdownCategory');

        // mark active item
        // 
        btn.html(itemValue);

        // Show all items except clicked item
        // 
        item.siblings().show();
        item.hide();

        // Change your data here
        // 
        console.log('Selected Category:', itemValue);

        // Get table data
        // Sample JSON format 
        /*
        tData = {"breakdownBy":"Org. Unit","years":[2018,2017],"rows":[{"firstCol":"All","otherCols":[{"value": 78,"year":2018},{"value": 89,"year":2017}]},{"firstCol":"Org. Unit 2","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 3","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 4","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 5","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 6","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 7","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 8","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 9","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 10","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 11","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 12","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 13","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]},{"firstCol":"Org. Unit 14","otherCols":[{"value": 45,"year":2018},{"value": 59,"year":2017}]}]};
        */
       
        // generate random dataset
        // 
        tData = {
          breakdownBy: "Org. Unit",
          years: [2018, 2017],
          rows: d3.range(1,15).map(function(d){
            return d == 1 ? {
              firstCol: "All",
              otherCols: [{
                value: Math.round(Math.random()*100),
                year: 2018
              }, {
                value: Math.round(Math.random()*100),
                year: 2017
              }]
            }: {
              firstCol: "Org. Unit " + d,
              otherCols: [{
                value: Math.round(Math.random()*100),
                year: 2018
              }, {
                value: Math.round(Math.random()*100),
                year: 2017
              }]
            };
          })
        };
        
        // draw table
        drawCategoryTable(tData);

      });

    });

    </script>
  </body>
</html>