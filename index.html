<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- fonts -->
    <script defer src="fonts/js/all.min.js"></script>

    <title>Strategy 360° Radar</title>
  </head>
  <body>

    <header>

      <!-- Logo -->
      <nav class="site-nav-logo navbar navbar-light bg-light">
        <div class="container">

          <a class="navbar-brand" href="index.html">
            <img src="images/co-brand-logo@1X.png" width="145" height="45" class="d-inline-block align-top" alt="">
            Strategy 360° radar
          </a>

          <!-- client logo -->
          <a class="float-right" href="#">
            <img class="rounded-circle border" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2275%22%20height%3D%2275%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2075%2075%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_1675f575c26%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.1)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A10pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_1675f575c26%22%3E%3Crect%20width%3D%2275%22%20height%3D%2275%22%20fill%3D%22white%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%2218.5546875%22%20y%3D%2242%22%3E75x75%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" width="145" height="45" class="d-inline-block align-top" alt="">
          </a>

        </div>
      </nav>

      <!-- Navigation -->
      <nav class="site-nav navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link active" href="index.html">Overview</a>
              <a class="nav-item nav-link" href="details.html">Details</a>
              <a class="nav-item nav-link" href="archetypes.html">Archetypes</a>
              <a class="nav-item nav-link" href="consistency.html">Consistency</a>
              <a class="nav-item nav-link" href="demographics.html">Demographics</a>
              <a class="nav-item nav-link" href="#">Pulse Check</a>
            </div>
          </div>
        </div>
      </nav>

      <!--
      <nav class="site-sub-nav navbar navbar-light bg-light">
        <div class="container">
          <div class="gutter"></div>
          <div class="navbar-collapse">
            <div class="navbar-nav">
              <a class="nav-item nav-link active" href="#">Dashboard</a>
              <a class="nav-item nav-link" href="#">Insights</a>
            </div>
          </div>
        </div>
      </nav>
      -->

      <!-- Navigation: Sub Header -->
      <nav class="site-sub-nav">
        <div class="container">

          <div class="gutter"></div>
          <div class="nav nav--sub" role="tablist">
            <a class="nav-item nav-link active" id="nav-dashb-tab" data-toggle="tab" href="#nav-dashb" role="tab" aria-controls="nav-dashb" aria-selected="true">Dashboard</a>
            <span class="sep border-right"></span>
            <a class="nav-item nav-link" id="nav-insights-tab" data-toggle="tab" href="#nav-insights" role="tab" aria-controls="nav-insights" aria-selected="false">Insights</a>
          </div>

        </div>
      </nav>

    </header>


    <main class="mt-2">
      
        <!-- Tabbed Content -->
        <div class="tab-content" id="nav-tabContent">

          <!-- Dashboard -->
          <div class="tab-pane fade show active tb--dashb" id="nav-dashb" role="tabpanel" aria-labelledby="nav-dashb-tab">

            <div class="container">

              <!-- Graphs -->
              <div class="row">

                <div class="col-5">

                  <h4>Performance by Category</h4>

                  <div class="graph-container perf-cat-graph" id="perf_cat_graph_full">

                    <div class="graph-info js-perf-cat-graph-info row justify-content-center align-items-end">
                      <!-- Filled using template -->
                    </div>

                    <div class="graph" id="perf_cat_graph">

                      <svg class="w-100 h-100"></svg>
                      
                    </div>

                    <button type="button" class="md-cb btn btn-transparent pl-0 js-show-details" data-html2canvas-ignore>
                      <input type="checkbox" /> <label>See Details</label>
                    </button>
                    
                  </div>

                  <button class="btn btn-download" data-target="#perf_cat_graph_full" data-html2canvas-ignore>
                    <i class="fas fa-arrow-down"></i>
                  </button>
                  
                </div>

                <div class="col-7">

                  <div>
                    <h4 class="inline">Performance by</h4>
                    <div class="dropdown inline dashboard-select js-dropdown-category">
                      <!--btn-secondary removed to prevent click color change-->
                      <button class="btn dropdown-toggle dashboard-select__category" type="button" id="dropdownCategory" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Org. Unit
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownCategory">
                        <a class="dropdown-item" href="#" data-value="Year">Year</a>
                        <a class="dropdown-item" href="#" data-value="Management Level">Management Level</a>
                        <a class="dropdown-item" href="#" data-value="Tenure">Tenure</a>
                        <a class="dropdown-item" href="#" data-value="Org. Unit">Org. Unit</a>
                      </div>
                    </div>
                  </div>

                  <div class="graph-container graph-container--table mt-4">

                    <div class="graph h-100" id="perf_cat_table">
                      
                    </div>
                    
                  </div>

                  <button class="btn btn-download" data-target="#perf_cat_table" data-html2canvas-ignore>
                    <i class="fas fa-arrow-down"></i>
                  </button>
                  
                </div>
                
              </div>

            </div>

            <!-- Highlights -->
            <div class="tb--dashb__highlights">

              <div class="container">

                <h4 class="mb-4">Highlights</h4>

                <div class="row">

                  <div class="col highlights-content" id="highlights_section">
                    <!-- Rendered with Template -->
                  </div>
                  
                </div>


              </div>
              
            </div>

            <!-- Participation -->
            <div class="tb--dashb__participation">

              <div class="container">

                <h4 class="mb-4">Participation</h4>

                <div id="participants_section" class="row pc-indicator align-items-center cursor-p js-hook" data-url="demographics.html">
                  <!-- Rendered using template -->
                </div>

              </div>
              
            </div>

            <!-- Camera Button -->
            <button class="btn btn-camera js-btn-camera" data-target="#nav-dashb" data-html2canvas-ignore>
              <i class="fas fa-camera" aria-hidden="true"></i>
            </button>


            <!-- PDF Button -->
            <button class="btn btn-pdf mt-5 js-btn-pdf" data-target="#nav-dashb" data-html2canvas-ignore>
              <i class="fas fa-file-pdf" aria-hidden="true"></i>
            </button>

            
          </div>

          <!-- Insights -->
          <div class="tab-pane fade" id="nav-insights" role="tabpanel" aria-labelledby="nav-insights-tab">

            <div class="container">

              <div class="row">

                <!-- Side Panel -->
                <div class="col-3">

                  <!-- Filters -->
                  <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Filter for:</h6>
                      <div class="dropright">
                        <!-- TODO: On button click, toggle the checkbox :checked attribute -->
                        <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="year" checked /> <label>Year</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="2018" checked /> <label>2018</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="2017" /> <label>2017</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">2018</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="org_unit" /> <label>Org Unit</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Commodity Checmicals" /> <label>Commodity Checmicals</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Speciality Checmicals" /> <label>Speciality Checmicals</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Agro Checmicals" /> <label>Agro Checmicals</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="management" checked /> <label>Management Level</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="C-Level" checked /> <label>C-Level</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Middle Management" checked /> <label>Middle Management</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Staff" /> <label>Staff</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">C-Level</span>
                          <span class="dropdown-item-text">Middle Management</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="geography" /> <label>Geography</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu"></div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="tenure" /> <label>Tenure</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Trigger Modals -->
                  <div class="sidepanel sidepanel--action clearfix js-action-panel">

                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Go to:</h6>

                      <button type="button" class="dropdown-item js-hook" data-url="details.html" data-tab="nav-cat" data-modal="modalCategories">
                        <i class="far fa-eye"></i>
                        <label>All Categories</label>
                      </button>

                      <button type="button" class="dropdown-item js-hook" data-url="details.html" data-tab="nav-questions" data-modal="modalAllQuestionFilter">
                        <i class="far fa-question-circle"></i>
                        <label>All Questions</label>
                      </button>

                      <button type="button" class="dropdown-item js-hook" data-url="details.html" data-tab="nav-questions" data-modal="modalAllQuestionFilter" data-tag="questions-not-on-chart">
                        <i class="far fa-question-circle"></i>
                        <label>Questions not on<br>this chart</label>
                      </button>
                      
                    </div>
                    
                  </div>

                </div>


                <!-- Insights Content -->
                <div class="col-9 insights-content">
                  
                  <div class="row insights-content__text">
                    <div class="col-10">
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa. Donec blandit, diam a tempor consequat, augue ante tristique mauris, aliquam dictum sem est vitae orci. </p>
                    </div>
                    <div class="col-2">
                      <button class="btn btn-download" data-target="#sp_question_graph" data-html2canvas-ignore>
                        <i class="fas fa-arrow-down"></i>
                      </button>
                    </div>
                  </div>

                  <div class="row" id="sp_question_graph">
                    <!-- Graph Info -->
                    <div class="insights-content__graphinfo graph-info js-question-graph-info w-50 text-right">
                      <!-- Filled using template -->
                    </div>

                    <!-- Graph -->
                    <div class="insights-content__graph" id="questions_graph">
                      <svg></svg>
                    </div>
                    
                  </div>

                </div>
                
              </div>
              
            </div>

            <!-- Camera Button -->
            <button class="btn btn-camera js-btn-camera" data-target="#sp_question_graph">
              <i class="fas fa-camera" aria-hidden="true"></i>
            </button>
            
          </div>

        </div>

      </div>
      
    </main>

    <!-- Site Footer -->
    <footer>

      <div class="container">

        <p>© 2018 PwC. All rights reserved. PwC refers to the PwC network and/or one or more of its member firms, each of which is a separate legal entity. Please see <a href="www.pwc.com/structure">www.pwc.com/structure</a> for further details.</p>

        <nav class="nav">
          <a class="nav-link pl-0" href="#">Privacy policy</a>
          <a class="nav-link" href="#">Terms of use</a>
          <a class="nav-link" href="#">Cookies info</a>
          <a class="nav-link" href="#">About site provider</a>
        </nav>
        
      </div>
      
    </footer>


    <!-- Modals -->

    <!-- 1. Categories Modal -->
    <div class="modal fade js-modal-inclusive" id="modalCategories" tabindex="-1" role="dialog" aria-labelledby="modalCategoriesTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCategoriesTitle">Show/Hide Categories</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body p-0">
            
            <div class="container-fluid p-0">
              
              <div class="row justify-content-center m-0">
                                
                <div class="col sidepanel sidepanel--category clearfix m-0 p-0 js-category-panel">

                  <div class="dropdown-menu show m-0 border-0">
                    <h6 class="dropdown-header">Categories:</h6>
                    
                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Strategy 360">
                      <label>Strategy 360°</label>
                    </button>

                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Value Proposition">
                      <label>Value Proposition</label>
                    </button>

                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Capabilities">
                      <label>Capabilities</label>
                    </button>

                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Portfolio">
                      <label>Portfolio</label>
                    </button>

                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Leadership">
                      <label>Leadership</label>
                    </button>

                    <button type="button" class="dropdown-item md-cb">
                      <input type="checkbox" checked value="Impact">
                      <label>Impact</label>
                    </button>

                    
                  </div>
                                  
                </div>
                                
              </div>
              
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 2. Single Question Modal with Panel -->
    <div class="modal modal-fs fade" id="modalQuestionFilter" tabindex="-1" role="dialog" aria-labelledby="modalQuestionFilterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

          <div class="modal-body">
            
            <div class="container-fluid">
              
              <div class="row">
                                
                <div class="col-md-auto">

                  <!-- Filters -->
                  <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Filter for:</h6>
                      <div class="dropright">
                        <!-- TODO: On button click, toggle the checkbox :checked attribute -->
                        <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="year" checked /> <label>Year</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="2018" checked /> <label>2018</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="2017" /> <label>2017</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">2018</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="org_unit" /> <label>Org Unit</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Commodity Checmicals" /> <label>Commodity Checmicals</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Speciality Checmicals" /> <label>Speciality Checmicals</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Agro Checmicals" /> <label>Agro Checmicals</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="management" checked /> <label>Management Level</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="C-Level" checked /> <label>C-Level</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Middle Management" checked /> <label>Middle Management</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="Staff" /> <label>Staff</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active">
                          <span class="dropdown-item-text">C-Level</span>
                          <span class="dropdown-item-text">Middle Management</span>
                        </div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="geography" /> <label>Geography</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu"></div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="tenure" /> <label>Tenure</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                          </button>
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active"></div>
                      </div>
                      <div class="dropright hide">
                        <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <input type="checkbox" value="question" checked /> <label>Question</label>
                          <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu--submenu">
                          <button class="dropdown-item md-cb" type="button">
                            <input type="checkbox" value=""  /> <label></label>
                          </button>
                        </div>
                        <div class="dropdown-item-selection active">
                          <!-- When a question is clicked on the Graph, its key is placed here -->
                          <span class="dropdown-item-text" id="selected_question"></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Categories -->
                  <div class="sidepanel sidepanel--breakdownby clearfix js-breakdownby-panel">
                    <div class="dropdown-menu show">
                      <h6 class="dropdown-header">Breakdown By:</h6>
                      <button type="button" class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="year" /> <label>Year</label>
                      </button>
                      <button type="button" class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="org_unit" /> <label>Org Unit</label>
                      </button>
                      <button type="button" class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="management" /> <label>Management Level</label>
                      </button>
                      <button type="button" class="dropdown-item md-cb md-cb--radio">
                        <input type="radio" name="breakdown_by" value="tenure" checked /> <label>Tenure</label>
                      </button>
                    </div>
                  </div>

                </div>

                <div class="col">

                  <div class="row">

                    <p class="text-justify col"><b class="mr-1">How to use:</b> Ambitioni dedisse scripsisse iudicaretur. Cras mattis iudicium purus sit amet fermentum. Donec sed odio operae, eu vulputate felis rhoncus. Praeterea iter est quasdam res quas ex communi. At nos hinc posthac, sitientis piros Afros. Petierunt uti sibi concilium totius Galliae in diem certam indicere. Cras mattis iudicium purus sit amet fermentum.</p>

                    <div class="col-md-auto p-2">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    
                  </div>
                 
                  <!-- Question and its Graph -->
                  <div class="js-modal-question graph-single-question" id="questions_list">
                    
                  </div>

              </div>
              
            </div>
          </div>
          
          </div>
        </div>
      </div>
    </div>

    <!-- Tooltip holder -->
    <div id="tooltip" class="tooltip shadow"></div>

    <!-- Template -->
    <!-- Overall template for Dashboard -->
    <script type="text/html" id="tpl_perf_info">
      <div>Overall</div>
      <div class="graph-info__value ml-2 mr-3">{{value}}</div>
      <div class="graph-info__benchmark">
        <div class="hl-indicator graph-info__benchmarkr1">
          <span class="hl-indicator__figure">{{movement}}</span>
          <span class="hl-indicator__indicator {{#indicator}}text-success{{/indicator}} {{^indicator}}text-danger{{/indicator}}">
            <i class="fas fa-caret-{{#indicator}}up{{/indicator}} {{^indicator}}down{{/indicator}}"></i>
          </span>
          <span>vs</span>
          <span class="hl-indicator__year">{{prevYear}}</span>
        </div>
        <div class="graph-info__benchmarkr2">
          Benchmark: {{benchmark}}
        </div>
      </div>
    </script>

    <!-- Overall Performance template for Insights -->
    <script type="text/html" id="tpl_perf_info_insights">
      <div class="graph-info__value">
        <b>Overall Performance: {{value}}</b>
      </div>
      <div class="graph-info__benchmark">
        <div class="hl-indicator graph-info__benchmarkr1 mb-0">
          <span class="hl-indicator__figure">{{movement}}</span>
          <span class="hl-indicator__indicator {{#indicator}}text-success{{/indicator}} {{^indicator}}text-danger{{/indicator}}">
            <i class="fas fa-caret-{{#indicator}}up{{/indicator}} {{^indicator}}down{{/indicator}}"></i>
          </span>
          <span>vs</span>
          <span class="hl-indicator__year">{{prevYear}}</span>
        </div>
        <div class="graph-info__benchmarkr2">
          All Organization: {{allOrgValue}}
        </div>
        <div class="graph-info__benchmarkr2">
          Benchmark: {{benchmark}}
        </div>
      </div>
    </script>

    <!-- Template of Performance by Table -->
    <script id="tpl_perf_table" type="text/html">

      <div class="tbl-fixed h-100">
        <div class="fix-column">
            <div class="thead">
                <span>{{breakdownBy}}</span>
            </div>
            <div class="tbody">
                {{#rows}}
                <div class="trow">
                    <span>{{firstCol}}</span>
                </div>
                {{/rows}}
                
            </div>
        </div>
        <div class="rest-columns">
            <div class="thead">
              {{#years}}
                <span>{{.}}</span>
              {{/years}}
            </div>
            <div class="tbody">
              {{#rows}}
              <div class="trow">
                  {{#otherCols}}
                  <span>
                    <b>{{.}}%</b>
                    <div class="tbar">
                      <div class="tbar__value" style="width: {{.}}%"></div>
                    </div>
                  </span>
                  {{/otherCols}}
              </div>
              {{/rows}}
            </div>
        </div>
      </div>
      
    </script>

    <!-- Template of Question Tooltip -->
    <script id="tpl_question_tooltip" type="text/html">
      <p class="mb-0 inline">
        <b class="mr-1">Q{{id}}:</b>
        {{key}}
      </p>
    </script>

    <!-- Template for a single question -->
    <script id="tpl_question" type="text/html">

      {{#questions}}

        <div class="alert alert-secondary" role="alert">
          <b class="mr-2">Q{{srno}}:</b>{{key}}
          <button class="btn btn-download" data-target="#id-{{qid}}-{{kid}}">
            <i class="fas fa-arrow-down"></i>
          </button>
        </div>


        <div class="gq pl-3 pr-3" id="id-{{qid}}-{{kid}}">

          <!-- Breakdown By Rows -->
          {{#values}}
          <div class="row gq-tuple align-items-center" data-id="{{qid}}-{{kid}}">
            <div class="col-3 gq-tuple__title">
              <label>{{key}}</label>
            </div>
            <div class="col gq-tuple__graph">
              
            </div>
          </div>
          {{/values}}

          <!-- Legend -->
          <div class="row gq-tuple" data-id="{{qid-kid}}">
            <div class="col-3"></div>
            <div class="col gq-tuple__legend"></div>
          </div>
          
        </div>

      {{/questions}}
      
    </script>

    <!-- Template for Participants section -->
    <script id="tpl_participants" type="text/html">

      <div class="col">
        <div class="row">

          <div class="col-md-auto">
            <label>Rate:</label>
            <span class="pc-indicator__rt">{{rate}}%</span>
          </div>

          <div class="col-md-auto">
            <label>Benchmark:</label>
            <span class="pc-indicator__bm">{{benchmark}}%</span>
          </div>

          <div class="col">
            <label>Progress:</label>
            <span class="pc-indicator__pg">{{progressValue}}%</span>
            <span class="pc-indicator__pgfigure">{{progressMovement}}%</span>
            <span class="pc-indicator__pgindicator text-{{#progressMovementUp}}success{{/progressMovementUp}}{{^progressMovementUp}}danger{{/progressMovementUp}}">
              <i class="fas fa-caret-{{#progressMovementUp}}up{{/progressMovementUp}}{{^progressMovementUp}}down{{/progressMovementUp}}"></i>
            </span>
            <span>vs</span>
            <span class="pc-indicator__pgyear">{{progressYear}}</span>
          </div>
          
        </div>

      </div>

      <div class="col">
        {{#figureValue}}
        <span class="pc-indicator__icon text-danger">
          <i class="fas fa-user-tie"></i>
        </span>
        {{/figureValue}}
        {{#figureValueInverse}}
        <span class="pc-indicator__icon text-secondary">
          <i class="fas fa-user-tie"></i>
        </span>
        {{/figureValueInverse}}
      </div>
      
    </script>

    <!-- Template for highlights -->
    <script id="tpl_highlights" type="text/html">

      {{#highlights}}
      <div class="hl-indicator cursor-p" data-question="{{question}}">

        <h5 class="hl-indicator__title">{{title}}</h5>

        <p class="hl-indicator__content">{{question}}</p>

        <div class="row justify-content-start">

          <div class="col-4">
            <span class="hl-indicator__figure">{{value}}%</span>
            <span class="hl-indicator__term">{{text}}</span>
          </div>

          <div class="col-4">
            <span class="hl-indicator__figure">{{indicatorValue}}%</span>
            <span class="hl-indicator__indicator text-{{#indicatorMovementUp}}success{{/indicatorMovementUp}}{{^indicatorMovementUp}}danger{{/indicatorMovementUp}}">
              <i class="fas fa-caret-{{#indicatorMovementUp}}up{{/indicatorMovementUp}}{{^indicatorMovementUp}}down{{/indicatorMovementUp}}"></i>
            </span>
            <span>vs</span>
            <span class="hl-indicator__year">{{indicatorYear}}</span>
          </div>
          
        </div>
        
      </div>
      {{/highlights}}
      
    </script>
    
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="js/d3.5.7.0.min.js"></script>
    <script src="js/d3-legend.min.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
    $(function() {

      // Sample Dataset - Performace Category Graph
      // 

      var categoryData = [{
        name: "Value Proposition",
        color: categoryColorMap["Value Proposition"][1],
        value: 1,
        // actual percentage
        depth: 61,
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Capabilities",
        color: categoryColorMap["Capabilities"][1],
        value: 1,
        depth: 31,
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Portfolio",
        color: categoryColorMap["Portfolio"][1],
        value: 1,
        depth: 94,
        indicator: -1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Leadership",
        color: categoryColorMap["Leadership"][1],
        value: 1,
        depth: 67,
        indicator: -1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }, {
        name: "Impact",
        color: categoryColorMap["Impact"][1],
        value: 1,
        depth: 26,
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      }];

      var progressData = [{
        // Mention the progress value here = 100 - progress value
        name: "noprogress",
        value: 46
      }, {
        // Mention the progress value here
        name: "progress",
        value: 54
      }];

      var overallData = {
        value: '54%',
        allOrgValue: '85%',
        // 1 for Up -1 for false
        indicator: 1,
        movement: '3%',
        prevYear: '2017',
        benchmark: '24%'
      };

      // Performance breakdown by Category - Table Data 
      var tableData = {
        breakdownBy: "Org. Unit",
        years: [2018, 2017, 2016, 2015],
        rows: d3.range(15).map(function(d){
          return {
            firstCol: "Category " + d,
            otherCols: [45, 85, 69, 89]
          };
        })
      };

      // Benchmark data for Questions Graph
      // The value of name property should match
      // categories defined in the raw dataset
      //  
      var benchmarkData = {
        
        "Value Proposition": {
          color: categoryColorMap["Value Proposition"][1],
          value: "23%",
          allOrgValue: '45%',
          // 1 for Up -1 for false
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
        }, 
        "Capabilities": {
          color: categoryColorMap["Capabilities"][1],
          value: "23%",
          allOrgValue: '45%',
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Portfolio": {
          color: categoryColorMap["Portfolio"][1],
          value: "23%",
          allOrgValue: '45%',
          indicator: -1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Leadership": {
          color: categoryColorMap["Leadership"][1],
          value: "23%",
          allOrgValue: '45%',
          indicator: -1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
          }, 
        "Strategy 360": {
          color: categoryColorMap["Impact"][1],
          value: "23%",
          allOrgValue: '45%',
          // 1 for Up -1 for false
          indicator: 1,
          movement: '3%',
          prevYear: '2017',
          benchmark: '24%'
        }
      };


      // Data for Participants section
      // 
      var participantsData = {
        rate: 54,
        benchmark: 59,
        progressValue: 8,
        progressMovement: 5,
        // if positive movement, otherwise false
        progressMovementUp: true,
        progressYear: 2017
      };

      // Data for highlights section
      // 
      var highlightsData = [{
          title: "Most Positive",
          question: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa 9",
          value: 70,
          text: "fully agree",
          indicatorValue: 10,
          indicatorMovementUp: true,
          indicatorYear: 2017
        },{
          title: "Most Positive",
          question: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa 11",
          value: 70,
          text: "fully agree",
          indicatorValue: 10,
          indicatorMovementUp: true,
          indicatorYear: 2017
        },{
          title: "Most Positive",
          question: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa 10",
          value: 70,
          text: "fully agree",
          indicatorValue: 10,
          indicatorMovementUp: true,
          indicatorYear: 2017
        },{
          title: "Most Positive",
          question: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa 2",
          value: 70,
          text: "fully agree",
          indicatorValue: 10,
          indicatorMovementUp: true,
          indicatorYear: 2017
        }]

      // Template for question
      // 
      var tpl_question_tooltip = $('#tpl_question_tooltip').html();
      Mustache.parse(tpl_question_tooltip);

      var bDrawQuestionsTabGraph = false,
      aDataset = null,
      edispatch = d3.dispatch('dataLoaded', 'tabOpened');

      // Category Graph - Aster Chart
      // 
      function drawCategroyGraph(progressData, data) {
        
        var target = '#perf_cat_graph svg';

        var totalRings = 7,
          width = $(target).width(),
          height = $(target).height(),
          maxRadius = Math.min(width, height) / 2,
          outerArcRadius = maxRadius * (data.length + 1) / totalRings,
          radius = maxRadius * data.length / totalRings,
          arcRadius = radius * 0.6;

        var pie = d3.pie()
          .sort(null)
          .value(function(d) {
            return d.value;
          });

        var arcLabel = d3.arc()
          .innerRadius(arcRadius)
          .outerRadius(arcRadius);

        var progressArc = d3.arc()
          .innerRadius(outerArcRadius)
          .outerRadius(maxRadius);

        var fullArc = d3.arc()
          .innerRadius(0)
          .outerRadius(outerArcRadius);

        var radiusScale = d3.scaleLinear()
          .domain([0, 100])
          .range([1, radius - 1]);

        function fnOuterRadius(d) {
          return radiusScale(d.data.depth);
        }

        var arc = d3.arc()
          .innerRadius(0)
          .outerRadius(fnOuterRadius);

        var chartData = pie(data),
          progressData = pie(progressData),
          ringCount = d3.range(chartData.length + 1),
          ringRadius = Math.round(radius / chartData.length);


        var arcs = chartData;
        var firstArcSection = /(^.+?)L/;
        var adeg = Math.PI / 180;
        var svg = d3.select(target)
          .attr("text-anchor", "middle");

        var g = svg.append("g")
          .attr("transform", 'translate(' + (width / 2) + ', ' + (height / 2) + ')');

        // Create full slices
        var gFullArcs = g.append("g")
          .classed("g-fullarcs", true);

        gFullArcs.selectAll("path")
          .data(arcs)
          .enter().append("path")
          .attr("fill", "none")
          .attr("stroke", "#333")
          .attr("d", fullArc)
          .each(function(d, i) {
            // setup arc label path
            // 
            var newArc = firstArcSection.exec(d3.select(this).attr("d"))[1],
              newArc = newArc.replace(/,/g, " ");
            
            //If the end angle lies beyond a quarter of a circle (90 degrees or pi/2)
            //flip the end and start position
            if (d.endAngle > 90 * adeg && d.endAngle < 300 * adeg) {
              //Everything between the capital M and first capital A
              var startLoc = /M(.*?)A/;
              //Everything between the capital A and 0 0 1
              var middleLoc = /A(.*?)0 0 1/;
              //Everything between the 0 0 1 and the end of the string (denoted by $)
              var endLoc = /0 0 1 (.*?)$/;
              //Flip the direction of the arc by switching the start and end point
              //and using a 0 (instead of 1) sweep flag
              var newStart = endLoc.exec(newArc)[1];
              var newEnd = startLoc.exec(newArc)[1];
              var middleSec = middleLoc.exec(newArc)[1];

              //Build up the new arc notation, set the sweep-flag to 0
              newArc = "M" + newStart + "A" + middleSec + "0 0 0 " + newEnd;
            } 

            gFullArcs.append("path")
              .attr("class", "hiddenArcs")
              .attr("id", "labelArc" + i)
              .attr("d", newArc)
              .style("fill", "none");
          })

        // Create Arcs/slices
        var gArcs = g.append("g")
          .classed("g-arcs", true);

        gArcs.selectAll("path")
          .data(arcs)
          .enter().append("path")
          .attr("fill", function(d){ 
            return d.data.color; 
          })
          .attr("fill-opacity", 0.8)
          .attr("stroke", "none")
          .attr("d", arc);

        // Create concentric rings
        var gRings = g.append("g")
          .classed("g-rings", true)
          .selectAll("circle")
          .data(ringCount);

        gRings.enter().append("circle")
          .attr("r", function(d) {
            return d * ringRadius;
          })
          .attr("fill", "none")
          .attr("stroke", function(d, i) {
            // make last ring black, rest white
            return i == (ringCount.length - 1) ? "#222" : "white";
          })
          .attr("stroke-width", 1);


        //Append the label names on the outside
        gFullArcs.selectAll(".arcText")
          .data(arcs)
          .enter().append("text")
          .attr("class", "arcText")
          //Move the labels below the arcs for slices with an end angle > than 90 degrees
          .attr("dy", function(d, i) {
            return 3 + ((d.endAngle > 90 * adeg && d.endAngle < 300 * adeg) ? -ringRadius / 2 : ringRadius / 2);
          })
          .append("textPath")
          .attr("startOffset", "50%")
          .style("text-anchor", "middle")
          .attr("xlink:href", function(d, i) { return "#labelArc" + i; })
          .text(function(d){ 
            return d.data.name;
          });

        var gText = g.append("g")
          .classed("g-text", true);

        var text = gText.selectAll("text")
          .data(arcs)
          .enter().append("text")
          .attr("transform", function(d){ 
            return 'translate(' + arcLabel.centroid(d) + ')'; })
          .attr("dy", "0.35em");

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "-0.7em")
          .style("font-size", "1.5em")
          .style("font-weight", "bold")
          .text(function(d){ return d.data.depth + '%'; });

        text.append("tspan")
          .attr("x", "-2em")
          .attr("y", "0.7em")
          .text(function(d){ return d.data.movement; });

        text.append("tspan")
          .attr("x", "-0.75em")
          .attr("y", "0.7em")
          .attr("class", function(d){ return d.data.indicator > 0 ? 'up' : 'down'; })
          .text(function(d){ return d.data.indicator > 0 ? '▲' : '▼' });

        text.append("tspan")
          .attr("x", "1.75em")
          .attr("y", "0.7em")
          .text(function(d){ return ('vs. ' + d.data.prevYear); });

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "1.7em")
          .text(function(d){ return  'Benchmark: ' + d.data.benchmark; });

        // Progress Arc
        g.append("g")
          .classed("progress-arc", true)
          .selectAll("path")
          .data(progressData)
          .enter().append("path")
          .attr("d", progressArc)
          .attr("fill", function(d, i) {
            // Not the first one
            return i > 0 ? "#222" : "none";
          })
          .classed("progress-arc-path", function(d, i) {
            // Not the first one
            return i > 0;
          });
      }

      // Category Graph - Table
      // 
      function drawCategoryTable(tableData) {

        var target = $('#perf_cat_table'),
        tpl = $('#tpl_perf_table').html();

        Mustache.parse(tpl);

        target.html(Mustache.render(tpl, tableData));

        initTableFixed();
        
      }

      // Question Graph - Insights
      // 
      function drawQuestionsGraph(benchmarkData, progressData, aData) {

        // Create a structure out of questions dataset
        var data = generateBucketedData(aData);

        var target = '#questions_graph svg';

        $(target).html('');

        var width = $(target).width(),
          height = $(target).height(),
          iReduceRadiusBy = 60,
          maxWidth = Math.min(width, height),
          width = maxWidth - 150,
          radius = width / 3,
          outerRadius = radius + 5 - iReduceRadiusBy,
          outerArcRadius = outerRadius + 20,
          maxRadius = outerArcRadius + 40,
          labelRadius = maxRadius + 40;
          

        var pie = d3.pie()
        .sort(null)
        .value(function(d) {
          return d.value;
        });
        
        var fullArc = d3.arc()
        .innerRadius(0)
        .outerRadius(maxRadius);

        var arcLabel = d3.arc()
          .innerRadius(labelRadius)
          .outerRadius(labelRadius);

        var progressData = pie(progressData);

        var y = d3.scaleLinear()
          .range([0, radius]);

        var x = d3.scaleLinear()
          .range([0, 2 * Math.PI]);

        var partition = function(data){
          return  d3.partition()
            (d3.hierarchy(data, function(d){ return d.values; })
              .count()
              //.sum(d => d.value)
              //.sort((a, b) => b.value - a.value)
            );
        };

        var lArc = d3.arc()
          .startAngle(function(d) { return x(d.x0); })
          .endAngle(function(d) { return x(d.x1); })
          .innerRadius(function(d, i) { 
            return d.depth > 1 ? (y(d.y0) - iReduceRadiusBy) : 0;
          })
          .outerRadius(function(d, i) {
            return y(d.y1)-.5 - iReduceRadiusBy;
          })
          .padAngle(function(d){ return Math.min((d.x1 - d.x0) / 2, 0.005); })
          .padRadius(radius / 2);

        var root = partition(data);

        // Add Pie arcs
        var pieData = pie(root.children.map(function(d){
          return d;
        }));

        function getBenchmarkData(sCategory) {
          return benchmarkData[sCategory] || {

          };
        }
        

        var svg = d3.select(target)
        .classed('js-skip-viewbox-auto-adjust', true)
        .style("width", maxWidth+'px')
        .style("height", maxWidth+'px');
        
  
        var g = svg.append("g")
        .attr("transform", 'translate(' + (maxWidth / 2) + ', ' + /*(maxWidth / 2)*/ labelRadius + ')');
  
        g.append("g")
          .attr("fill-opacity", 0.6)
        .selectAll("path")
        .data(root.descendants().filter(function(d){ return d.depth; }))
        .enter().append("path")
          .attr("fill", function(d){ while (d.depth > 1) d = d.parent; return getBenchmarkData(d.data.category).color; })
          .attr("d", lArc)
          .on('mouseover', showTooltip)
          .on('mouseout', hideTooltip)
          .on('click', function(d){
            onShowQuestion(d.data.key);
          });
        
        
          // Create full slices
        var gFullArcs = g.append("g")
          .classed("g-fullarcs", true);
        
        gFullArcs.selectAll("path")
          .data(pieData)
          .enter().append("path")
            .attr("fill", "none")
            .attr("stroke", "#333")
            .attr("d", fullArc);
        
        gFullArcs.append("circle")
          .attr("r", outerRadius)
          .attr("stroke", "black")
          .attr("fill", "none")
          .attr("stroke-width", 1);
        
        // Add a Circl with white stroke to hide the full arc slices' outer edge
        gFullArcs.append("circle")
          .attr("r", maxRadius)
          .attr("stroke", "white")
          .attr("fill", "none")
          .attr("stroke-width", 5);
        
        var progressArc = d3.arc()
        .innerRadius(outerRadius)
        .outerRadius(outerArcRadius);
        
        // Progress Arc
        g.append("g")
        .classed("progress-arc", true)
        .selectAll("path")
        .data(pie(progressData))
        .enter().append("path")
        .attr("d", progressArc)
        .attr("fill", function(d, i){
          // Not the first one
          return i > 0 ? "#222": "none";
        })
        .classed("progress-arc-path", function(d, i){
          // Not the first one
          return i > 0;
        });

        var gText = g.append("g")
          .classed("g-text", true);

        var text = gText.selectAll("text")
          .data(pieData)
          .enter().append("text")
          .attr("text-anchor", "middle")
          .attr("transform", function(d){ 
            return 'translate(' + arcLabel.centroid(d) + ')'; })
          .attr("dy", "0.35em");

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "-0.7em")
          .text(function(d){ return d.data.data.category + ': ' + getBenchmarkData(d.data.data.category).value; });

        text.append("tspan")
          .attr("x", "-2em")
          .attr("y", "0.7em")
          .text(function(d){ return getBenchmarkData(d.data.data.category).movement; });

        text.append("tspan")
          .attr("x", "-0.75em")
          .attr("y", "0.7em")
          .attr("class", function(d){ return getBenchmarkData(d.data.data.category).indicator > 0 ? 'up' : 'down'; })
          .text(function(d){ return getBenchmarkData(d.data.data.category).indicator > 0 ? '▲' : '▼' });

        text.append("tspan")
          .attr("x", "1.75em")
          .attr("y", "0.7em")
          .text(function(d){ return ('vs. ' + getBenchmarkData(d.data.data.category).prevYear); });

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "1.7em")
          .text(function(d){ return  'All Organization: ' + getBenchmarkData(d.data.data.category).allOrgValue; });

        text.append("tspan")
          .attr("x", 0)
          .attr("y", "2.8em")
          .text(function(d){ return  'Benchmark: ' + getBenchmarkData(d.data.data.category).benchmark; });


        try {
          var elSvg = svg.node(),
          bb = elSvg.getBoundingClientRect(),
          padding = 0;
          elSvg.setAttribute("width", bb.width + padding);
          elSvg.setAttribute("height", bb.height + padding);
          elSvg.setAttribute("viewBox", [0, 0, bb.width, bb.height].join(' '))
        }catch(e){

        }

      }

      /**
       * Draw graphs for Selected Question modal
       * @param  {array of Objects} data dataset
       */
      function drawQuestionModalGraph(data, aBreakdownBy) {

        var oConfig,
        tpl = $('#tpl_question').html(),
        qData = [],
        qDataMap = {},
        target = $('#questions_list'),
        tData;

        function parseData(aData) {
          // Assign a unique id to every question
          // 
          var i = 0,
          j = 0,
          key;

          return aData.map(function(q, srno){

            q.qid = 'q-'+ ++i;
            q.srno = srno+1;

            // Assign an Id to every Key
            // Add a key for 'All'
            // 
            var iMaxKeyCount = d3.max(q.values, function(d){ return d.values.length; }),
            iMaxKeys,
            oAll;

            // Find out index of max keys
            // 
            q.values.forEach(function(d, i){
              iMaxKeys = d.values.length == iMaxKeyCount ? i : iMaxKeys;
            });

            oAll = {
              key: 'All',
              values: q.values[iMaxKeys].values.map(function(d){ return {key: d.key, value: 0}; })
            };

            q.values.unshift(oAll);

            q.values.map(function(k){

              k.kid = 'k-'+ ++j;

              key = q.qid + '-' + k.kid;
              
              qDataMap[key] = {
                category: 'Impact',
                values: k.values
              };

              // Add values to 'All' Key
              if (k.key != 'All') {
                k.values.forEach(function(kv, z){
                  oAll.values[z].value += kv.value;
                });
              }

              return k;

            });

            return q;
          });

        }

        qData = parseData(getStructuredData(data, aBreakdownBy));

        tData = {
          questions: qData
        };

        Mustache.parse(tpl);

        // Add HTML
        target.html(Mustache.render(tpl, tData));

        // Render Charts
        // 
        var aLegendData = [];
        target.find('.gq-tuple').each(function(){

          var row = $(this),
          id = row.data('id'),
          data = qDataMap[id],  // generateData(),
          el = row.find('.gq-tuple__graph'),
          elLegend = row.find('.gq-tuple__legend'),
          isGraph = !!el.length,
          isLegend = !!elLegend.length;
          
          if (isGraph) {

            StackedBar( oConfig = {
              el: el[0],
              width: el.width(),
              height: 40,
              barHeight: 20,
              data: data.values,
              category: data.category,
              colors: categoryColorMap[data.category]
            });
            // choose the data with max keys
            aLegendData = aLegendData.length < data.values.length ? data.values : aLegendData;

          }else if (isLegend) {

            drawLegend({
              el: elLegend[0],
              data: aLegendData,
              colors: categoryColorMap[oConfig.category],
              shapePadding: elLegend.width() / aLegendData.length
            });

          }

        });

        initDownloadHook();


      }

      // Render Participants Section
      // 
      function drawParticipants(data) {
        var target = $('#participants_section'),
        tpl = $('#tpl_participants').html(),
        iMaxFigures = 10,
        rValue;

        // calculate figureValue and figureValueInverse from data
        // 
        data.figureValue = d3.range(rValue = Math.round(+data.rate / 10));
        data.figureValueInverse = d3.range(iMaxFigures-rValue);

        target.html(Mustache.render(tpl, data));
        
      }

      // Render Highlights Section
      // 
      function drawHighlights(data) {
        var target = $('#highlights_section'),
        tpl = $('#tpl_highlights').html();

        target.html(Mustache.render(tpl, { highlights: data }));

        // On questions click, show its details
        // 
        $('#highlights_section .hl-indicator').on('click', function(){
          onShowQuestion($(this).data('question'));
        });
      }
      
      // Show tooltip
      function showTooltip(d) {
        console.log(d);
        $('#tooltip')
          .css('top', d3.event.y + 'px')
          .css('left',  d3.event.x + 'px')
          .html(Mustache.render(tpl_question_tooltip, d.data))
          .show();
      }

      // hide tooltip
      function hideTooltip() {
        $('#tooltip').hide();
      }

      // Open the Question details modal
      // 
      function onShowQuestion(id) {
        console.log('question clicked', id);

        hideTooltip();

        // assign this id in the Filter panel
        // to enable data filtering
        // 
        $('#selected_question').html(id);

        // open the modal
        $('#modalQuestionFilter').modal('show');

        // trigger filter after modal is visible
        $('#modalQuestionFilter').off('shown.bs.modal');
        $('#modalQuestionFilter').on('shown.bs.modal', triggerFilter);

        function triggerFilter() {
          dispatch.call('getPanelSettings');
        }

      }

      // Read data File
      // 
      d3.json('data/data.json').then(function(data, error){
        if (error) {
          alert('Error reading data file.');
          return;
        }
        aDataset = data;

        edispatch.call('dataLoaded', null, data);
      });
        
      // Toggle Filter panels based on select tab: Categories or Insights
      // 
      $('.nav--sub a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

        edispatch.call('tabOpened', null, $(this).attr('href'));

      });


      // Draw Questions Graph;
      // 
      edispatch.on('tabOpened', function(sTabId){

        // Questions Tab
        // 
        if (sTabId == '#nav-insights') {
          bDrawQuestionsTabGraph = true;
        }else{  // Dashboard tab
          bDrawQuestionsTabGraph = false;
        }

        // get active filters
        dispatch.call('getPanelSettings');

      });

      // On Data Loaded
      // 
      edispatch.on('dataLoaded', function(data){
        // get active filters
        // 
        dispatch.call('getPanelSettings');


        // Render
        //             
        drawCategroyGraph(progressData, categoryData);
        drawCategoryTable(tableData);
        drawHighlights(highlightsData);
        drawParticipants(participantsData);

        initJSHooks();
        fixSVGIconFill();

      });

      // On Filter Change
      // 
      dispatch.on('filter.questions', function(oSettings){

        if (!aDataset){
          return false;
        }

        // If Modal is open, Selected question tab
        // 
        if ($('#modalQuestionFilter.show').length) {

          // Update the graph based on new settings
          // 
          var aBreakdownBy = ['question', oSettings.breakdownBy, 'response'];

          // Filter the raw dataset and update
          // 
          drawQuestionModalGraph(filterData(aDataset, oSettings), aBreakdownBy);

        }else if (bDrawQuestionsTabGraph) { 

          // If Question Tab
          // 

          // Update the graph based on new settings
          // 
          var aBreakdownBy = ['category', 'question'];

          // Filter the raw dataset and update
          // 
          drawQuestionsGraph(benchmarkData, progressData, getStructuredData(filterData(aDataset, oSettings), aBreakdownBy));

          fixSVGIconFill();

        }


      });

      // Show Overall Info
      // 
      $('.js-perf-cat-graph-info').html(Mustache.render($('#tpl_perf_info').html(), overallData));
      $('.js-question-graph-info').html(Mustache.render($('#tpl_perf_info_insights').html(), overallData));
      

      // Bind Events
      // 
      $('.js-show-details').on('click', function(){

        $('#perf_cat_graph').toggleClass('show-details');

      });

      // Handler Drop Down dropdownCategory
      // 
      $('.js-dropdown-category .dropdown-menu .dropdown-item').on('click', function(){

        var item = $(this),
        itemValue = item.data('value'),
        btn = $('#dropdownCategory');

        // mark active item
        // 
        btn.html(itemValue);

        // Show all items except clicked item
        // 
        item.siblings().show();
        item.hide();

        // Change your data here
        // 
        console.log('Selected Category:', itemValue);

        // Get table data
        // 
        // tData = {"breakdownBy":"Org. Unit","years":[2018,2017,2016,2015],"rows":[{"firstCol":"Category 0","otherCols":[45,85,69,89]},{"firstCol":"Category 1","otherCols":[45,85,69,89]},{"firstCol":"Category 2","otherCols":[45,85,69,89]},{"firstCol":"Category 3","otherCols":[45,85,69,89]},{"firstCol":"Category 4","otherCols":[45,85,69,89]},{"firstCol":"Category 5","otherCols":[45,85,69,89]},{"firstCol":"Category 6","otherCols":[45,85,69,89]},{"firstCol":"Category 7","otherCols":[45,85,69,89]},{"firstCol":"Category 8","otherCols":[45,85,69,89]},{"firstCol":"Category 9","otherCols":[45,85,69,89]},{"firstCol":"Category 10","otherCols":[45,85,69,89]},{"firstCol":"Category 11","otherCols":[45,85,69,89]},{"firstCol":"Category 12","otherCols":[45,85,69,89]},{"firstCol":"Category 13","otherCols":[45,85,69,89]},{"firstCol":"Category 14","otherCols":[45,85,69,89]}]};
        
        // draw table
        //drawCategoryTable(tData);

      });

    });

    // Generate nested Tree like data from a 1 level key:values structure
    // 
    function generateBucketedData(aData) {
      // maps to help re-produce consisten hierarchy for a give dataset
      var rMap = [3,3,2,3,1,2,3,1,3,2,1,3,2,3,3,2,2,1,3,2,1,3,3,1,2,1,1,2,2,1,3,2,2,2,3,3,1,2,1,2,3,1,3,3,1,2,2,1,1,1,1,1,1,2,1,1,3,1,1,2,2,1,1,2,2,3,1,1,3,3,2,3,2,3,2,1,2,2,1,3,3,1,1,2,3,3,3,3,3,3,2,2,3,3,3,1,1,1,1,3],
      pMap = [2,1,2,2,1,2,3,2,1,2,1,1,2,3,2,2,1,3,3,3,3,3,3,2,2,3,1,3,3,1,2,1,1,1,3,1,3,3,3,2,1,1,3,2,3,1,3,2,2,1,2,3,1,3,2,1,3,3,2,1,1,1,2,3,1,1,3,3,1,2,2,1,1,3,2,2,2,3,2,1,2,2,2,2,1,1,3,2,2,2,2,1,2,1,1,3,1,3,2,3];
      
      function getBuckets(cat){
        var partitions = cat.values.length,
            bucket = 0,
            ringCount = rMap.pop() || getRandomIntInclusive(1, 4),
            maxLeafCount = Math.floor(partitions / ringCount),
            dataset = [];
        
        // while all partitions have been put into buckets,
        // iterate and put random buckets in nested levels
        while(bucket < partitions){
          var slice = cat.values.slice(bucket, (pMap.pop() || getRandomIntInclusive(1, 3)) + bucket),
              first = slice.pop();
              if(first){
              dataset.push({
                key: first.key,
                name: first.key,
                values: slice
              });
              bucket+=1;
              }
          bucket += slice.length;
        }
        return {
          key: cat.key,
          name: cat.key,
          values: dataset
        }
      }
      
      // read each category
      return {
        "name": "root", 
        "values": aData.map(function(cat){
        
          var firstLevel = getBuckets(cat);

          firstLevel.category = cat.key;
          
          firstLevel.values = firstLevel.values.map(function(d){
            return getBuckets(d);
          });

          // we don't need categories in the data
          // just pick on question from the values and make it root
          // 
          var topQ = firstLevel.values.pop();

          firstLevel.key = topQ.key;
          firstLevel.name = topQ.name;

          return firstLevel;
        
        })
      };
     
    }

    </script>
  </body>
</html>