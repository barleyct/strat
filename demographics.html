<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- fonts -->
    <script defer src="fonts/js/all.min.js"></script>

    <title>Strategy 360° Radar</title>
  </head>
  <body>

    <header>

      <!-- Logo -->
      <nav class="site-nav-logo navbar navbar-light bg-light">
        <div class="container">

          <a class="navbar-brand" href="index.html">
            <img src="images/co-brand-logo@1X.png" width="145" height="45" class="d-inline-block align-top" alt="">
            Strategy 360° radar
          </a>

          <!-- client logo -->
          <a class="float-right" href="#">
            <img class="rounded-circle border" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2275%22%20height%3D%2275%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2075%2075%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_1675f575c26%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.1)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A10pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_1675f575c26%22%3E%3Crect%20width%3D%2275%22%20height%3D%2275%22%20fill%3D%22white%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%2218.5546875%22%20y%3D%2242%22%3E75x75%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" width="145" height="45" class="d-inline-block align-top" alt="">
          </a>

        </div>
      </nav>

      <!-- Navigation -->
      <nav class="site-nav navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link" href="index.html">Overview</a>
              <a class="nav-item nav-link" href="details.html">Details</a>
              <a class="nav-item nav-link" href="archetypes.html">Archetypes</a>
              <a class="nav-item nav-link" href="consistency.html">Consistency</a>
              <a class="nav-item nav-link active" href="demographics.html">Demographics</a>
              <a class="nav-item nav-link" href="#">Pulse Check</a>
            </div>
          </div>
        </div>
      </nav>

    </header>


    <main>
      
      <!-- Demographics Content -->
      <div class="container demographics-container">

        <div class="row">

          <!-- Side Panel -->
          <div class="col-3">

            <!-- Filters -->
            <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
              <div class="dropdown-menu show">
                <h6 class="dropdown-header">Filter for:</h6>
                <div class="dropright">
                  <!-- TODO: On button click, toggle the checkbox :checked attribute -->
                  <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="year" checked /> <label>Year</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="2018" checked /> <label>2018</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="2017" /> <label>2017</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active">
                    <span class="dropdown-item-text">2018</span>
                  </div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="org_unit" /> <label>Org Unit</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Commodity Checmicals" /> <label>Commodity Checmicals</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Speciality Checmicals" /> <label>Speciality Checmicals</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Agro Checmicals" /> <label>Agro Checmicals</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active"></div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="management" checked /> <label>Management Level</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="C-Level" checked /> <label>C-Level</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Middle Management" checked /> <label>Middle Management</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Staff" /> <label>Staff</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active">
                    <span class="dropdown-item-text">C-Level</span>
                    <span class="dropdown-item-text">Middle Management</span>
                  </div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="geography" /> <label>Geography</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu"></div>
                  <div class="dropdown-item-selection active"></div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="tenure" /> <label>Tenure</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active"></div>
                </div>
              </div>
            </div>

            <!-- Categories -->
            <div class="sidepanel sidepanel--breakdownby clearfix js-breakdownby-panel">
              <div class="dropdown-menu show">
                <h6 class="dropdown-header">Breakdown By:</h6>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="year" /> <label>Year</label>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="org_unit" /> <label>Org Unit</label>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="management" /> <label>Management Level</label>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="tenure" checked /> <label>Tenure</label>
                </button>
              </div>
            </div>

          </div>


          <!-- Demographics Content -->
          <div class="col-9 demographics-content">
            
            <div class="row demographics-content__text">
              <div class="col-10">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ex leo, facilisis quis eros in, imperdiet congue massa. Donec blandit, diam a tempor consequat, augue ante tristique mauris, aliquam dictum sem est vitae orci. </p>
              </div>
              <div class="col-2">
                <button class="btn btn-download" data-target="#demographics_list">
                  <i class="fas fa-arrow-down"></i>
                </button>
              </div>
            </div>  

            <div class="demographics-content__graph" id="demographics_list" data-html2canvas-no-padding>
              
            </div>

          </div>
          
        </div>
        
      </div>

      <!-- Camera Button -->
      <button class="btn btn-camera js-btn-camera" data-target="#demographics_list">
        <i class="fas fa-camera" aria-hidden="true"></i>
      </button>
      
    </main>

    <!-- Site Footer -->
    <footer>

      <div class="container">

        <p>© 2018 PwC. All rights reserved. PwC refers to the PwC network and/or one or more of its member firms, each of which is a separate legal entity. Please see <a href="www.pwc.com/structure">www.pwc.com/structure</a> for further details.</p>

        <nav class="nav">
          <a class="nav-link pl-0" href="#">Privacy policy</a>
          <a class="nav-link" href="#">Terms of use</a>
          <a class="nav-link" href="#">Cookies info</a>
          <a class="nav-link" href="#">About site provider</a>
        </nav>
        
      </div>
      
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/d3.5.7.0.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <script src="js/main.js"></script>

    <!-- Template for Demographics list -->
    <script id="tpl_demographics" type="text/html">

      <div class="row mb-3">
        <div class="col"></div>
        <div class="col-5">
          <h5 class="font-weight-bold">Participation rate</h5>
        </div>

        <div class="col-5">
          <h5 class="font-weight-bold">Number of participants</h5>
        </div>
      </div>

      {{#rows}}

        <div class="gq">

          <!-- Breakdown By Rows -->
          
          <div class="row gq-tuple" data-id="{{qid}}">
            <div class="col-2 gq-tuple__title">
              <label>{{key}}</label>
            </div>
            
            <div class="col-5 gq-tuple__graph">

              <figure class="demograph">

                <label class="demograph__value">{{valuePercentage}}</label>

                <div class="demograph__figures">
                  {{#figureValue}}
                  <i class="fas fa-user-tie text-danger"></i>
                  {{/figureValue}}

                  {{#figureValueInverse}}
                  <i class="fas fa-user-tie"></i>
                  {{/figureValueInverse}}
                </div>
                
              </figure>

            </div>

            <div class="col-5 gq-tuple__graph">

              <figure class="percentage-graph demograph-bar">
                
                <div class="percentage-graph__bar" style="-ms-flex: 0 0 {{valuePercentage}};flex: 0 0 {{valuePercentage}};max-width: {{valuePercentage}};">
                  <div class="percentage-graph__bar-bg" style="background: {{fill}};">
                    <label class="percentage-graph__bar-value">{{value}}</label>
                  </div>
                </div>

              </figure>

            </div>
          </div>
          

        </div>

      {{/rows}}
      
    </script>

    <script type="text/javascript">

      $(function(){

        var bDrawQuestionsTabGraph = false,
        aDataset = null,
        edispatch = d3.dispatch('dataLoaded', 'tabOpened');

        // Read data File
        // 
        d3.json('data/data.json').then(function(data, error){
          if (error) {
            alert('Error reading data file.');
            return;
          }
          aDataset = data;

          edispatch.call('dataLoaded', null, data);
        });

        // On Data Loaded
        // 
        edispatch.on('dataLoaded', function(data){
          // get active filters
          // 
          dispatch.call('getPanelSettings');
        });

        // On Filter Change
        // 
        dispatch.on('filter.questions', function(oSettings){

          if (!aDataset){
            return false;
          }

          // Update the graph based on new settings
          // 
          var aBreakdownBy = [oSettings.breakdownBy];

          // Filter the raw dataset and update
          // 
          drawGraphs(filterData(aDataset, oSettings), aBreakdownBy);

        });

        /**
         * Draw graphs for demographics
         * @param  {array of Objects} data dataset
         */
        function drawGraphs(data, aBreakdownBy) {

          var oConfig,
          tpl = $('#tpl_demographics').html(),
          qData = [],
          qDataMap = {},
          target = $('#demographics_list'),
          tData,
          format = d3.format('.2%');

          function parseData(aData) {
            // Assign a unique id to every question
            // 
            var i = 0,
            j = 0,
            key,
            iMaxFigures = 10;

            // Add a key for 'All'
            // 
            // Find the sum of all response count
            var sumTotal = d3.sum(aData, function(d){ return d.value; }),
            value = Math.random(),
            // Rounded value for 'All' key
            rValue = Math.round(10*value),
            oAll = {
              key: 'All',
              value: sumTotal,
              valuePercentage: format(value),
              fill: '#333',
              figureValue: d3.range(rValue),
              figureValueInverse: d3.range(iMaxFigures-rValue)
            };

            aData = aData.map(function(k, srno){

              // Graph Data
              // 

              // get rounded value;
              var rValue = Math.round(10*k.value/sumTotal);

              var gd = {
                // Breakdown by Key
                key: k.key,
                // Value in Count
                value: k.value,
                // Percentage value
                valuePercentage: format(k.value/sumTotal),
                // background color
                fill: 'gray',
                figureValue: d3.range(rValue),
                figureValueInverse: d3.range(iMaxFigures-rValue) 
              }

              return gd;

            });

            aData.unshift(oAll);

            return aData;

          }

          qData = parseData(getStructuredData(data, aBreakdownBy));

          tData = {
            rows: qData
          };

          Mustache.parse(tpl);

          // Add HTML
          target.html(Mustache.render(tpl, tData));

          fixSVGIconFill();

        }

      });
      
    </script>

  </body>
</html>