<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- fonts -->
    <script defer src="fonts/js/all.min.js"></script>

    <title>Strategy& - Aperture - Demographics</title>
  </head>
  <body>

    <header>

      <!-- Logo -->
      <nav class="site-nav-logo navbar navbar-light bg-light">
        <div class="container">

          <a class="navbar-brand" href="index.html">
            <img src="images/co-brand-logo@1X.png" width="145" height="45" class="d-inline-block align-top" alt="">
            Aperture
          </a>

          <!-- client logo -->
          <a class="float-right" href="#">
            <img class="rounded-circle border" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2275%22%20height%3D%2275%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2075%2075%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_1675f575c26%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.1)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A10pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_1675f575c26%22%3E%3Crect%20width%3D%2275%22%20height%3D%2275%22%20fill%3D%22white%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%2218.5546875%22%20y%3D%2242%22%3E75x75%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" width="145" height="45" class="d-inline-block align-top" alt="">
          </a>

        </div>
      </nav>

      <!-- Navigation -->
      <nav class="site-nav navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link" href="index.html">Overview</a>
              <a class="nav-item nav-link" href="details.html">Details</a>
              <a class="nav-item nav-link" href="archetypes.html">Archetypes</a>
              <a class="nav-item nav-link" href="consistency.html">Consistency</a>
              <a class="nav-item nav-link active" href="demographics.html">Demographics</a>
              <a class="nav-item nav-link" href="#">Pulse Check</a>
            </div>
          </div>
        </div>
      </nav>

    </header>


    <main>
      
      <!-- Demographics Content -->
      <div class="container demographics-container">

        <div class="row">

          <!-- Side Panel -->
          <div class="col-3">

            <!-- Filters -->
            <div class="sidepanel sidepanel--filter clearfix js-filter-panel">
              <div class="dropdown-menu show">
                <h6 class="dropdown-header">Filter for:</h6>
                <div class="dropright">
                  <!-- TODO: On button click, toggle the checkbox :checked attribute -->
                  <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="year" checked /> <label>Year</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="2018" checked /> <label>2018</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="2017" /> <label>2017</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active">
                    <span class="dropdown-item-text">2018</span>
                  </div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="org_unit" /> <label>Org. Unit</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Commodity Chemicals" /> <label>Commodity Chemicals</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Speciality Chemicals" /> <label>Speciality Chemicals</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Agro Chemicals" /> <label>Agro Chemicals</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active"></div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="management" checked /> <label>Management Level</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="C-Level" checked /> <label>C-Level</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Middle Management" checked /> <label>Middle Management</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Low Management" /> <label>Low Management</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="Staff" /> <label>Staff</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active">
                    <span class="dropdown-item-text">C-Level</span>
                    <span class="dropdown-item-text">Middle Management</span>
                  </div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="geography" /> <label>Geography</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu"></div>
                  <div class="dropdown-item-selection active"></div>
                </div>
                <div class="dropright">
                  <button type="button" class="dropdown-item md-cb" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" value="tenure" /> <label>Tenure</label>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu--submenu">
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="0-1 year" /> <label>0-1 year</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="1-3 year" /> <label>1-3 year</label>
                    </button>
                    <button class="dropdown-item md-cb" type="button">
                      <input type="checkbox" value="3+ year" /> <label>3+ year</label>
                    </button>
                  </div>
                  <div class="dropdown-item-selection active"></div>
                </div>
              </div>
            </div>

            <!-- Categories -->
            <div class="sidepanel sidepanel--breakdownby clearfix js-breakdownby-panel">
              <div class="dropdown-menu show">
                <h6 class="dropdown-header">Breakdown by:</h6>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="year" /> <label>Year</label>
                  <span class="md-cb__unset js-md-cb-reset">&times;</span>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="org_unit" /> <label>Org. Unit</label>
                  <span class="md-cb__unset js-md-cb-reset">&times;</span>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="management" /> <label>Management Level</label>
                  <span class="md-cb__unset js-md-cb-reset">&times;</span>
                </button>
                <button type="button" class="dropdown-item md-cb md-cb--radio">
                  <input type="radio" name="breakdown_by" value="tenure" checked /> <label>Tenure</label>
                  <span class="md-cb__unset js-md-cb-reset">&times;</span>
                </button>
              </div>
            </div>

          </div>


          <!-- Demographics Content -->
          <div class="col-9 demographics-content">
            
            <div class="row demographics-content__text">
              <div class="col-10">
                <p>Learn more about survey participants. Use the navigation on the left-hand side to see the number of respondents from specific parts of the organization (filter function) and to compare number of participants from different sub-segments of the organization (breakdown function).</p>
              </div>
              <div class="col-2">
                <button class="btn btn-download mr-md-5" data-target="#demographics_list">
                  <i class="icon icon--download"></i>
                </button>
              </div>
            </div>  

            <div class="demographics-content__graph" id="demographics_list" data-html2canvas-no-padding>
              
            </div>

          </div>
          
        </div>
        
      </div>

      <!-- Camera Button -->
      <button class="btn btn-camera js-btn-download" data-target="#demographics_list">
        <i class="icon icon--camera"></i>
      </button>
      
    </main>

    <!-- Site Footer -->
    <footer>

      <div class="container">

        <p>© 2018 PwC. All rights reserved. PwC refers to the PwC network and/or one or more of its member firms, each of which is a separate legal entity. Please see <a href="www.pwc.com/structure">www.pwc.com/structure</a> for further details.</p>

        <nav class="nav">
          <a class="nav-link pl-0" href="#">Privacy policy</a>
          <a class="nav-link" href="#">Terms of use</a>
          <a class="nav-link" href="#">Cookies info</a>
          <a class="nav-link" href="#">About site provider</a>
        </nav>
        
      </div>
      
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/d3.5.7.0.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="js/jspdf.min.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <script src="js/main.js"></script>

    <!-- Template for Demographics list -->
    <script id="tpl_demographics" type="text/html">

      <div class="row mb-3">
        <div class="col"></div>
        <div class="col-5">
          <h5 class="font-weight-bold font-heading">Participation rate</h5>
        </div>

        <div class="col-5">
          <h5 class="font-weight-bold font-heading">Number of participants</h5>
        </div>
      </div>

      {{#rows}}

        <div class="gq">

          <!-- Breakdown By Rows -->
          
          <div class="row align-items-center gq-tuple {{#isAll}}font-weight-bold{{/isAll}}" data-id="{{qid}}">
            <div class="col-2 gq-tuple__title">
              <label>{{key}}</label>
            </div>
            
            <div class="col-5 gq-tuple__graph">

              <figure class="demograph">

                <label class="demograph__value">{{valuePercentage}}</label>

                <div class="demograph__figures">
                  {{#figureValue}}
                  <svg class="text-danger" width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> <!-- Created with Method Draw - http://github.com/duopixel/Method-Draw/ --> <g> <g id="svg_1"> <path d="m0,0l0,101.000002l15.618055,0l2.875,-22.654862c1.229167,-3.766458 4.166667,-6.761389 7.888889,-8.037917l14.958333,-5.134167c0.173611,-0.056111 0.375,-0.014028 0.5,0.119236l1.166667,1.213403c1.854167,1.921806 4.333333,2.980903 6.993055,2.980903c2.659722,0 5.138889,-1.059097 6.993055,-2.980903l1.166667,-1.213403c0.131944,-0.133264 0.326389,-0.182361 0.5,-0.119236l14.958333,5.134167c3.722222,1.276528 6.659722,4.271458 7.888889,8.037917l2.875,22.654862l15.618055,0l0,-101.000002l-99.999999,0l0.000001,0zm95.743054,96.700488l-7.597222,0l-2.416667,-19.091806l-0.083333,-0.371736c-1.604167,-5.148195 -5.583333,-9.258334 -10.638889,-10.997778l-14.958333,-5.134167c-1.722222,-0.589167 -3.659722,-0.119236 -4.930555,1.199375l-1.166667,1.213403c-1.041667,1.080139 -2.4375,1.676319 -3.9375,1.676319c-1.493056,0 -2.895833,-0.596181 -3.9375,-1.676319l-1.166667,-1.213403c-1.270833,-1.318611 -3.208333,-1.788542 -4.930555,-1.199375l-14.958333,5.134167c-5.0625,1.739444 -9.041667,5.849583 -10.638889,10.997778l-2.5,19.463542l-7.597222,0l0,-92.386946l91.472221,0l0,92.386946l-0.013889,0zm-45.73611,-37.882015c4.159722,0 6.534722,-2.300556 9,-5.08507c3,-3.387708 4.513889,-9.21625 4.513889,-17.33132c0,-8.283403 -6.0625,-15.02375 -13.513889,-15.02375c-7.451389,0 -13.513889,6.740347 -13.513889,15.02375c0,8.11507 1.520833,13.943611 4.513889,17.33132c2.465278,2.7775 4.840278,5.08507 9,5.08507m0,-33.133612c5.097222,0 9.25,4.804514 9.25,10.710209c0,6.824514 -1.222222,11.958681 -3.430556,14.462639c-2.534722,2.868681 -3.784722,3.647222 -5.819444,3.647222c-2.034722,0 -3.284722,-0.785556 -5.819444,-3.647222c-2.215278,-2.503958 -3.430556,-7.638125 -3.430556,-14.462639c0,-5.905695 4.145833,-10.710209 9.25,-10.710209" id="svg_2" stroke="null" fill="#d93954"/> </g> </g> </svg>
                  {{/figureValue}}
                  {{#figureValueInverse}}                  
                  <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> <!-- Created with Method Draw - http://github.com/duopixel/Method-Draw/ --> <g> <g id="svg_1"> <path d="m0,0l0,101.000002l15.618055,0l2.875,-22.654862c1.229167,-3.766458 4.166667,-6.761389 7.888889,-8.037917l14.958333,-5.134167c0.173611,-0.056111 0.375,-0.014028 0.5,0.119236l1.166667,1.213403c1.854167,1.921806 4.333333,2.980903 6.993055,2.980903c2.659722,0 5.138889,-1.059097 6.993055,-2.980903l1.166667,-1.213403c0.131944,-0.133264 0.326389,-0.182361 0.5,-0.119236l14.958333,5.134167c3.722222,1.276528 6.659722,4.271458 7.888889,8.037917l2.875,22.654862l15.618055,0l0,-101.000002l-99.999999,0l0.000001,0zm95.743054,96.700488l-7.597222,0l-2.416667,-19.091806l-0.083333,-0.371736c-1.604167,-5.148195 -5.583333,-9.258334 -10.638889,-10.997778l-14.958333,-5.134167c-1.722222,-0.589167 -3.659722,-0.119236 -4.930555,1.199375l-1.166667,1.213403c-1.041667,1.080139 -2.4375,1.676319 -3.9375,1.676319c-1.493056,0 -2.895833,-0.596181 -3.9375,-1.676319l-1.166667,-1.213403c-1.270833,-1.318611 -3.208333,-1.788542 -4.930555,-1.199375l-14.958333,5.134167c-5.0625,1.739444 -9.041667,5.849583 -10.638889,10.997778l-2.5,19.463542l-7.597222,0l0,-92.386946l91.472221,0l0,92.386946l-0.013889,0zm-45.73611,-37.882015c4.159722,0 6.534722,-2.300556 9,-5.08507c3,-3.387708 4.513889,-9.21625 4.513889,-17.33132c0,-8.283403 -6.0625,-15.02375 -13.513889,-15.02375c-7.451389,0 -13.513889,6.740347 -13.513889,15.02375c0,8.11507 1.520833,13.943611 4.513889,17.33132c2.465278,2.7775 4.840278,5.08507 9,5.08507m0,-33.133612c5.097222,0 9.25,4.804514 9.25,10.710209c0,6.824514 -1.222222,11.958681 -3.430556,14.462639c-2.534722,2.868681 -3.784722,3.647222 -5.819444,3.647222c-2.034722,0 -3.284722,-0.785556 -5.819444,-3.647222c-2.215278,-2.503958 -3.430556,-7.638125 -3.430556,-14.462639c0,-5.905695 4.145833,-10.710209 9.25,-10.710209" id="svg_2" stroke="null"/> </g> </g> </svg>
                  {{/figureValueInverse}}
                </div>
                
              </figure>

            </div>

            <div class="col-5 gq-tuple__graph">

              <figure class="percentage-graph demograph-bar">
                
                <div class="percentage-graph__bar" style="-ms-flex: 0 0 {{valuePercentage}};flex: 0 0 {{valuePercentage}};max-width: {{valuePercentage}};">
                  <div class="percentage-graph__bar-bg" style="background: {{fill}};">
                    <label class="percentage-graph__bar-value">{{value}}</label>
                  </div>
                </div>

              </figure>

            </div>
          </div>
          

        </div>

      {{/rows}}
      
    </script>

    <script type="text/javascript">

      $(function(){

        var bDrawQuestionsTabGraph = false,
        aDataset = null,
        edispatch = d3.dispatch('dataLoaded', 'tabOpened');

        // Read data File
        // 
        d3.json('data/data-new.json').then(function(data, error){
          if (error) {
            alert('Error reading data file.');
            return;
          }
          aDataset = data;

          edispatch.call('dataLoaded', null, data);
        });

        // On Data Loaded
        // 
        edispatch.on('dataLoaded', function(data){
          // get active filters
          // 
          dispatch.call('getPanelSettings');
        });

        // On Filter Change
        // 
        dispatch.on('filter.questions', function(oSettings){

          if (!aDataset){
            return false;
          }

          // Update the graph based on new settings
          // 
          var aBreakdownBy = [oSettings.breakdownBy];

          // Filter the raw dataset and update
          // 
          drawGraphs(filterData(aDataset, oSettings), aBreakdownBy);

        });

        /**
         * Draw graphs for demographics
         * @param  {array of Objects} data dataset
         */
        function drawGraphs(data, aBreakdownBy) {

          var oConfig,
          tpl = $('#tpl_demographics').html(),
          qData = [],
          qDataMap = {},
          target = $('#demographics_list'),
          tData,
          format = d3.format('.0%');

          function parseData(aData) {
            // Assign a unique id to every question
            // 
            var i = 0,
            j = 0,
            key,
            iMaxFigures = 10;

            // Add a key for 'All'
            // 
            // Find the sum of all response count
            var sumTotal = d3.sum(aData, function(d){ return d.value; }),
            value = Math.random(),
            // Rounded value for 'All' key
            rValue = Math.round(10*value),
            oAll = {
              key: 'All',
              isAll: true,
              value: sumTotal,
              valuePercentage: format(rValue/10),
              fill: '#333',
              figureValue: d3.range(rValue),
              figureValueInverse: d3.range(iMaxFigures-rValue)
            };

            aData = aData.map(function(k, srno){

              // Graph Data
              // 

              // get rounded value;
              var rValue = Math.round(10*k.value/sumTotal);

              var gd = {
                // Breakdown by Key
                key: k.key,
                // Value in Count
                value: k.value,
                // Percentage value
                valuePercentage: format(k.value/sumTotal),
                // background color
                fill: 'gray',
                figureValue: d3.range(rValue),
                figureValueInverse: d3.range(iMaxFigures-rValue) 
              }

              return gd;

            });

            aData.unshift(oAll);

            // filter undefined key
            return aData.filter(function(d){
              return d.key != 'undefined';
            });

          }

          qData = parseData(getStructuredData(data, aBreakdownBy));

          tData = {
            rows: qData
          };

          Mustache.parse(tpl);

          // Add HTML
          target.html(Mustache.render(tpl, tData));

          fixSVGIconFill();

        }

      });
      
    </script>

  </body>
</html>